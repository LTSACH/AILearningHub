<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classification - Oxford Pets | AI Learning Hub</title>
    
    <!-- Load shared components from centralized library -->
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/themes/default.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/header.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/hero.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/comparison.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/theme-selector.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/language-switcher.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/pipeline.css">
    
    <!-- Custom styles -->
    <style>
        
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--ai-spacing-lg);
            margin: var(--ai-spacing-xl) 0;
        }
        
        .model-card {
            background: var(--ai-bg);
            border: 1px solid var(--ai-border);
            border-radius: var(--ai-radius-lg);
            padding: var(--ai-spacing-lg);
            transition: all var(--ai-transition-normal);
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .model-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--ai-shadow-lg);
            border-color: var(--ai-primary);
        }
        
        .comparison-table .metric-value.best {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            font-weight: bold !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3) !important;
            display: inline-block !important;
        }
        
        .comparison-table .metric-value.good {
            background: none !important;
            color: inherit !important;
            font-weight: normal !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            box-shadow: none !important;
        }
        
        .metric-value {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
    </style>
</head>
<body>
    <!-- Header -->
    <div id="ai-header"></div>

    <!-- Language Switcher (Top-right) -->
    <div id="language-switcher" class="ai-language-switcher fixed"></div>

    <div class="ai-container">
        
    <!-- Hero Section -->
    <div id="ai-hero"></div>
    
    <!-- Pipeline Section -->
    <section class="ai-section">
        <h2 class="ai-heading-2" data-en="🔄 Pipeline" data-vi="🔄 Quy Trình">🔄 Pipeline</h2>
        <p class="ai-text-light" style="font-size: var(--ai-font-size-lg); margin-bottom: 2rem;" 
           data-en="Computer Vision classification pipeline with CNN architectures"
           data-vi="Quy trình phân loại thị giác máy tính với kiến trúc CNN">
            Computer Vision classification pipeline with CNN architectures
        </p>
        
        <!-- Pipeline Tabs -->
        <div class="pipeline-section">
            <!-- Tabs -->
            <div class="pipeline-tabs">
                <button class="pipeline-tab-btn active" onclick="switchPipelineTab('pipeline')">
                    🔄 Pipeline
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('tutorials')">
                    📚 Tutorials
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('code')">
                    💻 Code
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('colab')">
                    🚀 Colab
                </button>
            </div>
            
            <!-- Tab 1: Pipeline (default) -->
            <div id="pipeline-tab" class="pipeline-tab-content active">
                <div class="pipeline-flow">
                    <div class="step step-fixed" onclick="switchPipelineDetailTab('input')">
                        <div class="step-icon">🖼️</div>
                        <div class="step-title" data-en="Image Input" data-vi="Đầu Vào Ảnh">Image Input</div>
                        <div class="step-detail" data-en="224×224 RGB images" data-vi="Ảnh RGB 224×224">224×224 RGB images</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-fixed" onclick="switchPipelineDetailTab('preprocessing')">
                        <div class="step-icon">🔧</div>
                        <div class="step-title" data-en="Preprocessing" data-vi="Tiền Xử Lý">Preprocessing</div>
                        <div class="step-badge" data-en="Fixed" data-vi="Cố Định">Fixed</div>
                        <div class="step-detail" data-en="Normalize, Resize" data-vi="Chuẩn hóa, Thay đổi kích thước">Normalize, Resize</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-interactive" onclick="switchPipelineDetailTab('cnn-model')">
                        <div class="step-icon">🧠</div>
                        <div class="step-title" data-en="CNN Model" data-vi="Mô Hình CNN">CNN Model</div>
                        <div class="step-badge" data-en="Choose Below" data-vi="Chọn Bên Dưới">Choose Below</div>
                        <div class="step-detail" data-en="ResNet50, EfficientNet, MobileNet..." data-vi="ResNet50, EfficientNet, MobileNet...">ResNet50, EfficientNet, MobileNet...</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-fixed" onclick="switchPipelineDetailTab('classifier-head')">
                        <div class="step-icon">🎯</div>
                        <div class="step-title" data-en="Classifier Head" data-vi="Đầu Phân Loại">Classifier Head</div>
                        <div class="step-badge" data-en="Adapted" data-vi="Điều Chỉnh">Adapted</div>
                        <div class="step-detail" data-en="1000 → 37 classes" data-vi="1000 → 37 lớp">1000 → 37 classes</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-result" onclick="switchPipelineDetailTab('results')">
                        <div class="step-icon">✨</div>
                        <div class="step-title" data-en="Classification Results" data-vi="Kết Quả Phân Loại">Classification Results</div>
                        <div class="step-detail" data-en="37 breed predictions" data-vi="Dự đoán 37 giống">37 breed predictions</div>
                    </div>
                </div>
                
                <!-- Pipeline Detail Tabs -->
                <div class="pipeline-detail-tabs">
                    <div class="pipeline-detail-tab-buttons">
                        <button class="pipeline-detail-tab-btn active" onclick="switchPipelineDetailTab('input')">
                            🖼️ Input Image
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('preprocessing')">
                            🔧 Preprocessing
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('cnn-model')">
                            🧠 CNN Model
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('classifier-head')">
                            🎯 Classifier Head
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('results')">
                            ✨ Classification Results
                        </button>
                    </div>
                    
                    <!-- Pipeline detail content will be loaded by JavaScript -->
                </div>
            </div>
            
            <!-- Other tabs content will be loaded by JavaScript -->
        </div>
    </section>

    <!-- Include comparison component -->
    <!-- Model Comparison Section -->
<section class="ai-section">
    <h2 class="ai-heading-2" data-en="📊 Model Comparison" data-vi="📊 So Sánh Mô Hình">📊 Model Comparison</h2>
    <p class="ai-text-light" style="margin-bottom: 2rem;"
       data-en="Compare performance metrics across CNN models"
       data-vi="So sánh các chỉ số hiệu suất giữa các mô hình CNN">
        Compare performance metrics across CNN models
    </p>
    
    <!-- Comparison Tabs -->
    <div class="comparison-section">
        <div class="comparison-tabs">
            <button class="comparison-tab-btn active" onclick="switchComparisonTab('performance')">
                📈 Performance
            </button>
            <button class="comparison-tab-btn" onclick="switchComparisonTab('resources')">
                ⚡ Resources
            </button>
            <button class="comparison-tab-btn" onclick="switchComparisonTab('formulas')">
                🧮 Formulas
            </button>
        </div>
        
        <!-- Performance Tab -->
        <div id="performance-tab" class="comparison-tab-content active">
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th data-en="Model" data-vi="Mô Hình">Model</th>
                            <th data-en="Precision ↑" data-vi="Precision ↑">Precision ↑</th>
                            <th data-en="Recall ↑" data-vi="Recall ↑">Recall ↑</th>
                            <th data-en="F1-Score ↑" data-vi="F1-Score ↑">F1-Score ↑</th>
                            <th data-en="Accuracy ↑" data-vi="Độ Chính Xác ↑">Accuracy ↑</th>
                            <th data-en="Top-5 Accuracy ↑" data-vi="Top-5 Accuracy ↑">Top-5 Acc ↑</th>
                        </tr>
                    </thead>
                    <tbody id="performance-table-body">
                        <!-- Dynamic content will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Resources Tab -->
        <div id="resources-tab" class="comparison-tab-content">
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th data-en="Model" data-vi="Mô Hình">Model</th>
                            <th data-en="Training Time ↓" data-vi="Thời Gian Huấn Luyện ↓">Training Time ↓</th>
                            <th data-en="Inference Time ↓" data-vi="Thời Gian Dự Đoán ↓">Inference Time ↓</th>
                            <th data-en="FLOPs ↓" data-vi="FLOPs ↓">FLOPs ↓</th>
                            <th data-en="Parameters ↓" data-vi="Tham Số ↓">Parameters ↓</th>
                            <th data-en="Model Size ↓" data-vi="Kích Thước ↓">Model Size ↓</th>
                        </tr>
                    </thead>
                    <tbody id="resources-table-body">
                        <!-- Dynamic content will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Formulas Tab -->
        <div id="formulas-tab" class="comparison-tab-content">
            <div class="formulas-content">
                <!-- Content will be populated by MetricsWalkthrough component -->
            </div>
        </div>
    </div>
</section>
    
    <!-- Include confusion matrix component -->
    <!-- Confusion Matrix Section -->
<section class="ai-section">
    <h2 class="ai-heading-2" data-en="📊 Confusion Matrix" data-vi="📊 Ma Trận Nhầm Lẫn">📊 Confusion Matrix</h2>
    <p class="ai-text-light" style="margin-bottom: 2rem;"
       data-en="Select a model from the comparison table above to view its confusion matrix"
       data-vi="Chọn một mô hình từ bảng so sánh ở trên để xem ma trận nhầm lẫn">
        Select a model from the comparison table above to view its confusion matrix
    </p>
    
    <div id="model-selection-info" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; text-align: center; border: 2px dashed #dee2e6;">
        <p style="margin: 0; color: #6c757d; font-style: italic;">
            <span data-en="Click on a model row in the comparison table to view its confusion matrix" data-vi="Nhấp vào dòng mô hình trong bảng so sánh để xem ma trận nhầm lẫn">
                Click on a model row in the comparison table to view its confusion matrix
            </span>
        </p>
    </div>
    
    <div id="confusion-matrix-plotly" style="display: flex; justify-content: center; align-items: center; width: 100%;"></div>
</section>

    </div>

    <!-- Footer -->
    <footer style="background: var(--ai-bg-light); color: var(--ai-text); text-align: center; padding: 2rem; margin-top: 4rem; border-top: 1px solid var(--ai-border);">
        <p data-en="© 2025 AI Learning Hub - Educational content for AI enthusiasts" data-vi="© 2025 AI Learning Hub - Nội dung giáo dục cho những người đam mê AI">© 2025 AI Learning Hub - Educational content for AI enthusiasts</p>
        <div id="theme-selector" style="margin-top: 1rem;"></div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Load shared components JavaScript -->
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/utils/ThemeManager.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/utils/LanguageManager.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/Header.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/Hero.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/ComparisonTable.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/Pipeline.js"></script>
    
    
<script>
    // Initialize components when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize header
        const header = new AIHeader('ai-header', {
            brand: '📚 AI Learning Hub',
            brandUrl: '../../index.html',
            navItems: [
                { label: 'Home', url: '../../index.html', active: false },
                { label: 'Data Analysis', url: '../../01_Data_Analysis/', active: false },
                { label: 'Machine Learning', url: '../../02_Machine_Learning/', active: false },
                { label: 'Computer Vision', url: '../index.html', active: false },
                { label: 'Classification', url: 'index.html', active: true }
            ]
        });
        
        // Initialize hero section with dynamic data
        fetch('./assets/data/models_data.json')
            .then(response => response.json())
            .then(data => {
                // Find best accuracy from real data
                let bestAccuracy = 0;
                let bestModel = '';
                Object.values(data.models).forEach(model => {
                    if (model.accuracy > bestAccuracy) {
                        bestAccuracy = model.accuracy;
                        bestModel = model.name;
                    }
                });
                
                const hero = new AIHero('ai-hero', {
                    title: '📊 Breed Classification',
                    titleVi: '📊 Phân Loại Giống Chó',
                    subtitle: '37-class breed classification using CNN architectures and transfer learning',
                    subtitleVi: 'Phân loại 37 giống chó sử dụng kiến trúc CNN và transfer learning',
                    stats: [
                        { value: '37', label: 'Breeds', labelVi: 'Giống' },
                        { value: '7,393', label: 'Images', labelVi: 'Ảnh' },
                        { value: '10', label: 'Models', labelVi: 'Mô Hình' },
                        { value: (bestAccuracy * 100).toFixed(1) + '%', label: 'Best Accuracy', labelVi: 'Độ Chính Xác Tốt Nhất' }
                    ],
                    gradient: false
                });
                
                // Initialize comparison tables with real data
                initializeComparisonTables(data);
            });
        
        // Initialize theme selector
        window.AIThemeManager.createThemeSelector('theme-selector');
        
        // Initialize language manager
        window.AILanguageManager.createLanguageSwitcher('language-switcher');
        
        // Initialize comparison tab switching
        window.switchComparisonTab = function(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.comparison-tab-content');
            tabContents.forEach(content => content.style.display = 'none');
            
            // Remove active class from all buttons
            const tabButtons = document.querySelectorAll('.comparison-tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Add active class to clicked button
            const clickedButton = document.querySelector(`[onclick="switchComparisonTab('${tabName}')"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // If formulas tab is selected, render KaTeX
            if (tabName === 'formulas') {
                setTimeout(() => {
                    const formulasContainer = document.querySelector('#formulas-tab .formulas-content');
                    if (formulasContainer && typeof renderMathInElement !== 'undefined') {
                        console.log('Rendering KaTeX for formulas tab...');
                        renderMathInElement(formulasContainer, {
                            delimiters: [
                                {left: '\\(', right: '\\)', display: false},
                                {left: '\\[', right: '\\]', display: true}
                            ],
                            throwOnError: false
                        });
                        console.log('KaTeX rendering completed for formulas tab');
                    }
                }, 100);
            }
        };
        
        // Function to initialize comparison tables with real data
        function initializeComparisonTables(data) {
            // Populate Performance table
            const performanceTbody = document.getElementById('performance-table-body');
            if (performanceTbody) {
                performanceTbody.innerHTML = '';
                
                const models = Object.values(data.models);
                const metrics = ['precision', 'recall', 'f1_score', 'accuracy', 'top5_accuracy'];
                
                models.forEach((model, index) => {
                    const row = document.createElement('tr');
                    let rowHTML = `<td><strong>${model.name}</strong></td>`;
                    
                    metrics.forEach(metric => {
                        const value = model[metric];
                        const isBest = isBestInColumn(models, metric, value);
                        const className = isBest ? 'best' : '';
                        
                        // Add augmentation indicator
                        const augIndicator = model.name.includes('(Aug)') ? ' (Aug)' : ' (No Aug)';
                        rowHTML += `<td><span class="metric-value ${className}">${(value * 100).toFixed(1)}%${augIndicator}</span></td>`;
                    });
                    
                    row.innerHTML = rowHTML;
                    performanceTbody.appendChild(row);
                });
            }
            
            // Populate Resources table
            const resourcesTbody = document.getElementById('resources-table-body');
            if (resourcesTbody) {
                resourcesTbody.innerHTML = '';
                
                const models = Object.values(data.models);
                const resourceMetrics = ['training_time', 'inference_time', 'flops', 'parameters', 'model_size'];
                
                models.forEach((model, index) => {
                    const row = document.createElement('tr');
                    let rowHTML = `<td><strong>${model.name}</strong></td>`;
                    
                    resourceMetrics.forEach(metric => {
                        const value = model[metric];
                        const isBest = isBestInColumn(models, metric, value, 'resources');
                        const className = isBest ? 'best' : '';
                        let displayValue;
                        
                        if (metric === 'flops') {
                            displayValue = `${(value / 1e9).toFixed(1)}B`;
                        } else if (metric === 'parameters') {
                            displayValue = `${value.toFixed(1)}M`;
                        } else if (metric === 'model_size') {
                            displayValue = `${value.toFixed(1)}MB`;
                        } else if (metric === 'training_time') {
                            displayValue = `${value.toFixed(1)}min`;
                        } else {
                            displayValue = `${value.toFixed(1)}ms`;
                        }
                        
                        // Add augmentation indicator
                        const augIndicator = model.name.includes('(Aug)') ? ' (Aug)' : ' (No Aug)';
                        rowHTML += `<td><span class="metric-value ${className}">${displayValue}${augIndicator}</span></td>`;
                    });
                    
                    row.innerHTML = rowHTML;
                    resourcesTbody.appendChild(row);
                });
            }
            
            // Add click handlers to comparison table rows
            const comparisonRows = document.querySelectorAll('.comparison-table tbody tr');
            comparisonRows.forEach((row, index) => {
                row.style.cursor = 'pointer';
                row.addEventListener('click', function() {
                    // Remove previous selection
                    comparisonRows.forEach(r => r.style.backgroundColor = '');
                    
                    // Highlight selected row
                    this.style.backgroundColor = '#e3f2fd';
                    
                    // Get model name from first cell
                    const modelName = this.cells[0].textContent.trim();
                    
                    // Clear selection info
                    const infoDiv = document.getElementById('model-selection-info');
                    infoDiv.innerHTML = '';
                    
                    // Show confusion matrix for selected model
                    showConfusionMatrix(modelName, data);
                });
            });
        }
        
        // Helper function to check if value is best in column
        function isBestInColumn(models, metric, value, type = 'performance') {
            if (type === 'performance') {
                // Higher is better for performance metrics
                const maxValue = Math.max(...models.map(model => model[metric]));
                return Math.abs(value - maxValue) < 0.0001; // Floating point tolerance
            } else if (type === 'resources') {
                // Lower is better for resource metrics
                const minValue = Math.min(...models.map(model => model[metric]));
                return Math.abs(value - minValue) < 0.0001; // Floating point tolerance
            }
            return false;
        }
        
        // Function to show confusion matrix for selected model
        function showConfusionMatrix(modelName, data) {
            // Map model names to confusion matrix keys
            let modelKey = '';
            switch(modelName) {
                case 'VGG16 (No Aug)':
                    modelKey = 'vgg16_noaug';
                    break;
                case 'ResNet50 (Aug)':
                    modelKey = 'resnet50_aug';
                    break;
                case 'ResNet50 (No Aug)':
                    modelKey = 'resnet50_noaug';
                    break;
                case 'Xception (Aug)':
                    modelKey = 'xception_aug';
                    break;
                case 'Xception (No Aug)':
                    modelKey = 'xception_noaug';
                    break;
                case 'EfficientNet-B0 (Aug)':
                    modelKey = 'efficientnet_b0_aug';
                    break;
                case 'EfficientNet-B0 (No Aug)':
                    modelKey = 'efficientnet_b0_noaug';
                    break;
                case 'MobileNetV3-Large-100 (Aug)':
                    modelKey = 'mobilenetv3_large_100_aug';
                    break;
                case 'MobileNetV3-Large-100 (No Aug)':
                    modelKey = 'mobilenetv3_large_100_noaug';
                    break;
                default:
                    modelKey = 'resnet50_aug'; // Default fallback
            }
            
            const confusionData = data.confusion_matrix[modelKey];
            if (!confusionData) {
                console.error('No confusion data found for model:', modelKey);
                return;
            }
            
            const matrix = confusionData.matrix;
            const classNames = confusionData.class_names;
            
            const plotData = [{
                z: matrix,
                x: classNames,
                y: classNames,
                type: 'heatmap',
                colorscale: 'Blues',
                showscale: true,
                hoverongaps: false,
                hovertemplate: 'True: %{y}<br>Predicted: %{x}<br>Count: %{z}<extra></extra>'
            }];
            
            const layout = {
                title: {
                    text: `Confusion Matrix - ${modelName}`,
                    font: { size: 16 }
                },
                xaxis: {
                    title: 'Predicted Class',
                    tickangle: -45,
                    tickfont: { size: 10 }
                },
                yaxis: {
                    title: 'True Class',
                    tickfont: { size: 10 }
                },
                width: 800,
                height: 600,
                margin: { l: 150, r: 50, t: 80, b: 150 }
            };
            
            const config = {
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
            };
            
            // Render the confusion matrix
            Plotly.newPlot('confusion-matrix-plotly', plotData, layout, config)
                .then(() => {
                    console.log('Plotly heatmap rendered successfully!');
                })
                .catch(error => {
                    console.error('Error rendering Plotly heatmap:', error);
                });
        }
    });
</script>

</body>
</html>