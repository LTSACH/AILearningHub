<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classification - Oxford Pets | AI Learning Hub</title>
    
    <!-- Load shared components from centralized library -->
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/themes/default.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/header.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/hero.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/comparison.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/theme-selector.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/language-switcher.css">
    <link rel="stylesheet" href="https://ltsach.github.io/AILearningHub/ai-report-components/css/components/pipeline.css">
    
    <!-- Custom styles -->
    <style>
        
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--ai-spacing-lg);
            margin: var(--ai-spacing-xl) 0;
        }
        
        .model-card {
            background: var(--ai-bg);
            border: 1px solid var(--ai-border);
            border-radius: var(--ai-radius-lg);
            padding: var(--ai-spacing-lg);
            transition: all var(--ai-transition-normal);
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .model-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--ai-shadow-lg);
            border-color: var(--ai-primary);
        }
        
        .comparison-table .metric-value.best {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            font-weight: bold !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3) !important;
            display: inline-block !important;
        }
        
        .comparison-table .metric-value.good {
            background: none !important;
            color: inherit !important;
            font-weight: normal !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
            box-shadow: none !important;
        }
        
        .metric-value {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
    </style>
</head>
<body>
    <!-- Header -->
    <div id="ai-header"></div>

    <!-- Language Switcher (Top-right) -->
    <div id="language-switcher" class="ai-language-switcher fixed"></div>

    <div class="ai-container">
        
    <!-- Hero Section -->
    <div id="ai-hero"></div>
    
    <!-- Pipeline Section -->
    <section class="ai-section">
        <h2 class="ai-heading-2" data-en="🔄 Pipeline" data-vi="🔄 Quy Trình">🔄 Pipeline</h2>
        <p class="ai-text-light" style="font-size: var(--ai-font-size-lg); margin-bottom: 2rem;" 
           data-en="Computer Vision classification pipeline with CNN architectures"
           data-vi="Quy trình phân loại thị giác máy tính với kiến trúc CNN">
            Computer Vision classification pipeline with CNN architectures
        </p>
        
        <!-- Pipeline Tabs -->
        <div class="pipeline-section">
            <!-- Tabs -->
            <div class="pipeline-tabs">
                <button class="pipeline-tab-btn active" onclick="switchPipelineTab('pipeline')">
                    🔄 Pipeline
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('tutorials')">
                    📚 Tutorials
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('code')">
                    💻 Code
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('colab')">
                    🚀 Colab
                </button>
            </div>
            
            <!-- Tab 1: Pipeline (default) -->
            <div id="pipeline-tab" class="pipeline-tab-content active">
                <div class="pipeline-flow">
                    <div class="step step-fixed" onclick="switchPipelineDetailTab('input')">
                        <div class="step-icon">🖼️</div>
                        <div class="step-title" data-en="Image Input" data-vi="Đầu Vào Ảnh">Image Input</div>
                        <div class="step-detail" data-en="224×224 RGB images" data-vi="Ảnh RGB 224×224">224×224 RGB images</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-fixed" onclick="switchPipelineDetailTab('preprocessing')">
                        <div class="step-icon">🔧</div>
                        <div class="step-title" data-en="Preprocessing" data-vi="Tiền Xử Lý">Preprocessing</div>
                        <div class="step-badge" data-en="Fixed" data-vi="Cố Định">Fixed</div>
                        <div class="step-detail" data-en="Normalize, Resize" data-vi="Chuẩn hóa, Thay đổi kích thước">Normalize, Resize</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-interactive" onclick="switchPipelineDetailTab('cnn-model')">
                        <div class="step-icon">🧠</div>
                        <div class="step-title" data-en="CNN Model" data-vi="Mô Hình CNN">CNN Model</div>
                        <div class="step-badge" data-en="Choose Below" data-vi="Chọn Bên Dưới">Choose Below</div>
                        <div class="step-detail" data-en="ResNet50, EfficientNet, MobileNet..." data-vi="ResNet50, EfficientNet, MobileNet...">ResNet50, EfficientNet, MobileNet...</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-fixed" onclick="switchPipelineDetailTab('classifier-head')">
                        <div class="step-icon">🎯</div>
                        <div class="step-title" data-en="Classifier Head" data-vi="Đầu Phân Loại">Classifier Head</div>
                        <div class="step-badge" data-en="Adapted" data-vi="Điều Chỉnh">Adapted</div>
                        <div class="step-detail" data-en="1000 → 37 classes" data-vi="1000 → 37 lớp">1000 → 37 classes</div>
                    </div>
                    
                    <div class="arrow">→</div>
                    
                    <div class="step step-result" onclick="switchPipelineDetailTab('results')">
                        <div class="step-icon">✨</div>
                        <div class="step-title" data-en="Classification Results" data-vi="Kết Quả Phân Loại">Classification Results</div>
                        <div class="step-detail" data-en="37 breed predictions" data-vi="Dự đoán 37 giống">37 breed predictions</div>
                    </div>
                </div>
                
                <!-- Pipeline Detail Tabs -->
                <div class="pipeline-detail-tabs">
                    <div class="pipeline-detail-tab-buttons">
                        <button class="pipeline-detail-tab-btn active" onclick="switchPipelineDetailTab('input')">
                            🖼️ Input Image
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('preprocessing')">
                            🔧 Preprocessing
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('cnn-model')">
                            🧠 CNN Model
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('classifier-head')">
                            🎯 Classifier Head
                        </button>
                        <button class="pipeline-detail-tab-btn" onclick="switchPipelineDetailTab('results')">
                            ✨ Classification Results
                        </button>
                    </div>
                    
                    <!-- Pipeline detail content will be loaded by JavaScript -->
                </div>
            </div>
            
            <!-- Other tabs content will be loaded by JavaScript -->
        </div>
    </section>

    <!-- Include comparison component -->
    <!-- Model Comparison Section -->
<section class="ai-section">
    <h2 class="ai-heading-2" data-en="📊 Model Comparison" data-vi="📊 So Sánh Mô Hình">📊 Model Comparison</h2>
    <p class="ai-text-light" style="margin-bottom: 2rem;"
       data-en="Compare performance metrics across CNN models"
       data-vi="So sánh các chỉ số hiệu suất giữa các mô hình CNN">
        Compare performance metrics across CNN models
    </p>
    
    <!-- Comparison Tabs -->
    <div class="comparison-section">
        <div class="comparison-tabs">
            <button class="comparison-tab-btn active" onclick="switchComparisonTab('performance')">
                📈 Performance
            </button>
            <button class="comparison-tab-btn" onclick="switchComparisonTab('resources')">
                ⚡ Resources
            </button>
            <button class="comparison-tab-btn" onclick="switchComparisonTab('formulas')">
                🧮 Formulas
            </button>
        </div>
        
        <!-- Performance Tab -->
        <div id="performance-tab" class="comparison-tab-content active">
            <div class="comparison-table-container">
                <table class="comparison-table enhanced-table">
                    <thead>
                        <tr class="table-header-row">
                            <th class="model-column" data-en="Model" data-vi="Mô Hình">Model</th>
                            <th class="metric-column" data-en="Precision ↑" data-vi="Precision ↑">Precision ↑</th>
                            <th class="metric-column" data-en="Recall ↑" data-vi="Recall ↑">Recall ↑</th>
                            <th class="metric-column" data-en="F1-Score ↑" data-vi="F1-Score ↑">F1-Score ↑</th>
                            <th class="metric-column" data-en="Accuracy ↑" data-vi="Độ Chính Xác ↑">Accuracy ↑</th>
                            <th class="metric-column" data-en="Top-5 Accuracy ↑" data-vi="Top-5 Accuracy ↑">Top-5 Acc ↑</th>
                        </tr>
                    </thead>
                    <tbody id="performance-table-body">
                        <!-- Dynamic content will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Resources Tab -->
        <div id="resources-tab" class="comparison-tab-content">
            <div class="comparison-table-container">
                <table class="comparison-table enhanced-table">
                    <thead>
                        <tr class="table-header-row">
                            <th class="model-column" data-en="Model" data-vi="Mô Hình">Model</th>
                            <th class="metric-column" data-en="Training Time ↓ (min)" data-vi="Thời Gian Huấn Luyện ↓ (phút)">Training Time ↓ (min)</th>
                            <th class="metric-column" data-en="Inference Time ↓ (ms)" data-vi="Thời Gian Dự Đoán ↓ (ms)">Inference Time ↓ (ms)</th>
                            <th class="metric-column" data-en="FLOPs ↓ (B)" data-vi="FLOPs ↓ (B)">FLOPs ↓ (B)</th>
                            <th class="metric-column" data-en="Parameters ↓ (M)" data-vi="Tham Số ↓ (M)">Parameters ↓ (M)</th>
                            <th class="metric-column" data-en="Model Size ↓ (MB)" data-vi="Kích Thước ↓ (MB)">Model Size ↓ (MB)</th>
                        </tr>
                    </thead>
                    <tbody id="resources-table-body">
                        <!-- Dynamic content will be loaded here -->
                    </tbody>
                </table>
                <div class="table-note">
                    <small>📝 Note: Training/Inference times are calculated as <strong>total time</strong> for training and <strong>average time</strong> for inference per sample.</small>
                </div>
            </div>
        </div>
        
        <!-- Formulas Tab -->
        <div id="formulas-tab" class="comparison-tab-content">
            <div class="formulas-content">
                <!-- Classification Metrics Formulas -->
                <div class="formulas-section">
                    <h3>📊 Classification Metrics Formulas</h3>
                    
                    <!-- Basic Metrics -->
                    <div class="metric-group">
                        <h4>🎯 Basic Classification Metrics</h4>
                        
                        <div class="formula-card">
                            <h5>Accuracy</h5>
                            <div class="formula">
                                \[\text{Accuracy} = \frac{\text{TP} + \text{TN}}{\text{TP} + \text{TN} + \text{FP} + \text{FN}} = \frac{\text{Correct Predictions}}{\text{Total Predictions}}\]
                            </div>
                            <p class="formula-description">
                                Overall correctness of the model across all classes
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>Precision</h5>
                            <div class="formula">
                                \[\text{Precision} = \frac{\text{TP}}{\text{TP} + \text{FP}} = \frac{\text{True Positives}}{\text{True Positives} + \text{False Positives}}\]
                            </div>
                            <p class="formula-description">
                                Proportion of positive predictions that are actually correct
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>Recall</h5>
                            <div class="formula">
                                \[\text{Recall} = \frac{\text{TP}}{\text{TP} + \text{FN}} = \frac{\text{True Positives}}{\text{True Positives} + \text{False Negatives}}\]
                            </div>
                            <p class="formula-description">
                                Proportion of actual positives that are correctly identified
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>F1-Score</h5>
                            <div class="formula">
                                \[\text{F1-Score} = 2 \times \frac{\text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}} = \frac{2\text{TP}}{2\text{TP} + \text{FP} + \text{FN}}\]
                            </div>
                            <p class="formula-description">
                                Harmonic mean of precision and recall
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>Top-5 Accuracy</h5>
                            <div class="formula">
                                \[\text{Top-5 Accuracy} = \frac{\text{Number of correct predictions in top-5}}{\text{Total predictions}}\]
                            </div>
                            <p class="formula-description">
                                Accuracy when considering top-5 predictions
                            </p>
                        </div>
                    </div>
                    
                    <!-- Averaging Methods -->
                    <div class="metric-group">
                        <h4>📈 Averaging Methods</h4>
                        
                        <div class="formula-card">
                            <h5>Macro Average</h5>
                            <div class="formula">
                                \[\text{Macro-Precision} = \frac{1}{n} \sum_{i=1}^{n} \text{Precision}_i\]
                                \[\text{Macro-Recall} = \frac{1}{n} \sum_{i=1}^{n} \text{Recall}_i\]
                                \[\text{Macro-F1} = \frac{1}{n} \sum_{i=1}^{n} \text{F1}_i\]
                            </div>
                            <p class="formula-description">
                                Simple average across all classes (treats all classes equally)
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>Weighted Average</h5>
                            <div class="formula">
                                \[\text{Weighted-Precision} = \frac{\sum_{i=1}^{n} \text{Precision}_i \times \text{Support}_i}{\sum_{i=1}^{n} \text{Support}_i}\]
                                \[\text{Weighted-Recall} = \frac{\sum_{i=1}^{n} \text{Recall}_i \times \text{Support}_i}{\sum_{i=1}^{n} \text{Support}_i}\]
                                \[\text{Weighted-F1} = \frac{\sum_{i=1}^{n} \text{F1}_i \times \text{Support}_i}{\sum_{i=1}^{n} \text{Support}_i}\]
                            </div>
                            <p class="formula-description">
                                Average weighted by the number of true instances for each class
                            </p>
                        </div>
                    </div>
                    
                    <!-- Resource Metrics -->
                    <div class="metric-group">
                        <h4>⚡ Resource Metrics</h4>
                        
                        <div class="formula-card">
                            <h5>FLOPs (Floating Point Operations)</h5>
                            <div class="formula">
                                \[\text{FLOPs} = \sum_{l=1}^{L} \text{FLOPs}_l\]
                                \[\text{FLOPs}_l = 2 \times \text{MACs}_l\]
                            </div>
                            <p class="formula-description">
                                Total floating point operations for forward pass
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>Model Parameters</h5>
                            <div class="formula">
                                \[\text{Parameters} = \sum_{l=1}^{L} \text{Parameters}_l\]
                                \[\text{Parameters}_l = \text{Input Size}_l \times \text{Output Size}_l + \text{Bias}_l\]
                            </div>
                            <p class="formula-description">
                                Total number of trainable parameters in the model
                            </p>
                        </div>
                        
                        <div class="formula-card">
                            <h5>Transfer Learning Ratio</h5>
                            <div class="formula">
                                \[\text{Transfer Ratio} = \frac{\text{Pre-trained Parameters}}{\text{Total Parameters}} = \frac{\text{Backbone Parameters}}{\text{Total Parameters}}\]
                            </div>
                            <p class="formula-description">
                                Ratio of pre-trained parameters to total parameters
                            </p>
                        </div>
                    </div>
                </div>
                
                <style>
                .formulas-section {
                    max-width: 900px;
                    margin: 0 auto;
                    padding: 2rem;
                }
                
                .metric-group {
                    margin-bottom: 2rem;
                }
                
                .metric-group h4 {
                    color: #2563eb;
                    border-bottom: 2px solid #e5e7eb;
                    padding-bottom: 0.5rem;
                    margin-bottom: 1rem;
                }
                
                .formula-card {
                    background: #f8f9fa;
                    border: 1px solid #e5e7eb;
                    border-radius: 8px;
                    padding: 1.5rem;
                    margin-bottom: 1rem;
                    transition: all 0.2s ease;
                }
                
                .formula-card:hover {
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    border-color: #2563eb;
                }
                
                .formula-card h5 {
                    color: #1f2937;
                    margin-bottom: 1rem;
                    font-size: 1.1rem;
                }
                
                .formula {
                    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                    padding: 1.5rem;
                    border-radius: 8px;
                    border: 2px solid #3b82f6;
                    margin: 1rem 0;
                    text-align: center;
                    font-size: 1.2rem;
                    color: #1e40af;
                    font-weight: 500;
                    box-shadow: 0 4px 6px rgba(59, 130, 246, 0.1);
                    transition: all 0.3s ease;
                }
                
                .formula:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 15px rgba(59, 130, 246, 0.2);
                    border-color: #2563eb;
                }
                
                .formula-description {
                    color: #666;
                    font-style: italic;
                    margin-top: 0.5rem;
                    line-height: 1.5;
                }
                </style>
            </div>
        </div>
    </div>
</section>
    
    <!-- Include confusion matrix component -->
    <!-- Confusion Matrix Section -->
<section class="ai-section">
    <h2 class="ai-heading-2" data-en="📊 Confusion Matrix" data-vi="📊 Ma Trận Nhầm Lẫn">📊 Confusion Matrix</h2>
    <p class="ai-text-light" style="margin-bottom: 2rem;"
       data-en="Select a model from the comparison table above to view its confusion matrix"
       data-vi="Chọn một mô hình từ bảng so sánh ở trên để xem ma trận nhầm lẫn">
        Select a model from the comparison table above to view its confusion matrix
    </p>
    
    <div id="model-selection-info" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; text-align: center; border: 2px dashed #dee2e6;">
        <p style="margin: 0; color: #6c757d; font-style: italic;">
            <span data-en="Click on a model row in the comparison table to view its confusion matrix" data-vi="Nhấp vào dòng mô hình trong bảng so sánh để xem ma trận nhầm lẫn">
                Click on a model row in the comparison table to view its confusion matrix
            </span>
        </p>
    </div>
    
    <div id="confusion-matrix-plotly" style="display: flex; justify-content: center; align-items: center; width: 100%;"></div>
</section>

    </div>

    <!-- Footer -->
    <footer style="background: var(--ai-bg-light); color: var(--ai-text); text-align: center; padding: 2rem; margin-top: 4rem; border-top: 1px solid var(--ai-border);">
        <p data-en="© 2025 AI Learning Hub - Educational content for AI enthusiasts" data-vi="© 2025 AI Learning Hub - Nội dung giáo dục cho những người đam mê AI">© 2025 AI Learning Hub - Educational content for AI enthusiasts</p>
        <div id="theme-selector" style="margin-top: 1rem;"></div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Load shared components JavaScript -->
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/utils/ThemeManager.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/utils/LanguageManager.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/Header.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/Hero.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/ComparisonTable.js"></script>
    <script src="https://ltsach.github.io/AILearningHub/ai-report-components/js/components/Pipeline.js"></script>
    
    
<script>
    // Initialize components when page loads
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize header
        const header = new AIHeader('ai-header', {
            brand: '📚 AI Learning Hub',
            brandUrl: '../../index.html',
            navItems: [
                { label: 'Home', url: '../../index.html', active: false },
                { label: 'Data Analysis', url: '../../01_Data_Analysis/', active: false },
                { label: 'Machine Learning', url: '../../02_Machine_Learning/', active: false },
                { label: 'Computer Vision', url: '../index.html', active: false },
                { label: 'Classification', url: 'index.html', active: true }
            ]
        });
        
        // Initialize hero section with dynamic data
        fetch('./assets/data/models_data.json')
            .then(response => response.json())
            .then(data => {
                // Find best accuracy from real data
                let bestAccuracy = 0;
                let bestModel = '';
                    Object.entries(data.models).forEach(([modelName, model]) => {
                        if (model.accuracy > bestAccuracy) {
                            bestAccuracy = model.accuracy;
                            bestModel = modelName;
                        }
                    });
                
                const hero = new AIHero('ai-hero', {
                    title: '📊 Breed Classification',
                    titleVi: '📊 Phân Loại Giống Chó',
                    subtitle: '37-class breed classification using CNN architectures and transfer learning',
                    subtitleVi: 'Phân loại 37 giống chó sử dụng kiến trúc CNN và transfer learning',
                    stats: [
                        { value: '37', label: 'Breeds', labelVi: 'Giống' },
                        { value: '7,393', label: 'Images', labelVi: 'Ảnh' },
                        { value: '10', label: 'Models', labelVi: 'Mô Hình' },
                        { value: (bestAccuracy * 100).toFixed(1) + '%', label: 'Best Accuracy', labelVi: 'Độ Chính Xác Tốt Nhất' }
                    ],
                    gradient: false
                });
                
                // Initialize comparison tables with real data
                initializeComparisonTables(data);
            });
        
        // Initialize theme selector
        window.AIThemeManager.createThemeSelector('theme-selector');
        
        // Initialize language manager
        window.AILanguageManager.createLanguageSwitcher('language-switcher');
        
        // Initialize comparison tab switching
        window.switchComparisonTab = function(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.comparison-tab-content');
            tabContents.forEach(content => content.style.display = 'none');
            
            // Remove active class from all buttons
            const tabButtons = document.querySelectorAll('.comparison-tab-btn');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.style.display = 'block';
            }
            
            // Add active class to clicked button
            const clickedButton = document.querySelector(`[onclick="switchComparisonTab('${tabName}')"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // If formulas tab is selected, render KaTeX
            if (tabName === 'formulas') {
                setTimeout(() => {
                    const formulasContainer = document.querySelector('#formulas-tab .formulas-content');
                    if (formulasContainer) {
                        // Add formulas content if not already present
                        if (!formulasContainer.innerHTML.trim()) {
                            formulasContainer.innerHTML = `
                                <!-- Classification Metrics Formulas -->
                                <div class="formulas-section">
                                    <h3>📊 Classification Metrics Formulas</h3>
                                    
                                    <!-- Basic Metrics -->
                                    <div class="metric-group">
                                        <h4>🎯 Basic Classification Metrics</h4>
                                        
                                        <div class="formula-card">
                                            <h5>Accuracy</h5>
                                            <div class="formula">
                                                \\[\\text{Accuracy} = \\frac{\\text{TP} + \\text{TN}}{\\text{TP} + \\text{TN} + \\text{FP} + \\text{FN}} = \\frac{\\text{Correct Predictions}}{\\text{Total Predictions}}\\]
                                            </div>
                                            <p class="formula-description">
                                                Overall correctness of the model across all classes
                                            </p>
                                        </div>
                                        
                                        <div class="formula-card">
                                            <h5>Precision (per class i)</h5>
                                            <div class="formula">
                                                \\[\\text{Precision}_i = \\frac{\\text{TP}_i}{\\text{TP}_i + \\text{FP}_i} = \\frac{\\text{True Positives}_i}{\\text{True Positives}_i + \\text{False Positives}_i}\\]
                                            </div>
                                            <p class="formula-description">
                                                Of all instances predicted as class i, how many were actually class i?
                                            </p>
                                        </div>
                                        
                                        <div class="formula-card">
                                            <h5>Recall (per class i)</h5>
                                            <div class="formula">
                                                \\[\\text{Recall}_i = \\frac{\\text{TP}_i}{\\text{TP}_i + \\text{FN}_i} = \\frac{\\text{True Positives}_i}{\\text{True Positives}_i + \\text{False Negatives}_i}\\]
                                            </div>
                                            <p class="formula-description">
                                                Of all actual instances of class i, how many did we correctly identify?
                                            </p>
                                        </div>
                                        
                                        <div class="formula-card">
                                            <h5>F1-Score (per class i)</h5>
                                            <div class="formula">
                                                \\[\\text{F1}_i = \\frac{2 \\times \\text{Precision}_i \\times \\text{Recall}_i}{\\text{Precision}_i + \\text{Recall}_i} = \\frac{2 \\times \\text{TP}_i}{2 \\times \\text{TP}_i + \\text{FP}_i + \\text{FN}_i}\\]
                                            </div>
                                            <p class="formula-description">
                                                Harmonic mean of precision and recall for class i
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Top-K Accuracy -->
                                    <div class="metric-group">
                                        <h4>🏆 Top-K Accuracy</h4>
                                        
                                        <div class="formula-card">
                                            <h5>Top-5 Accuracy</h5>
                                            <div class="formula">
                                                \\[\\text{Top-5 Accuracy} = \\frac{1}{N} \\sum_{i=1}^{N} \\mathbb{1}[\\text{true\\_label}_i \\in \\text{top\\_5\\_predictions}_i]\\]
                                            </div>
                                            <p class="formula-description">
                                                Percentage of samples where the true class is among the top 5 predicted classes
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Averaging Methods -->
                                    <div class="metric-group">
                                        <h4>📈 Averaging Methods</h4>
                                        
                                        <div class="formula-card">
                                            <h5>Macro Average</h5>
                                            <div class="formula">
                                                \\[\\text{Metric}_{\\text{macro}} = \\frac{1}{C} \\sum_{i=1}^{C} \\text{Metric}_i\\]
                                            </div>
                                            <p class="formula-description">
                                                Equal weight to each class (good for imbalanced datasets)
                                            </p>
                                        </div>
                                        
                                        <div class="formula-card">
                                            <h5>Weighted Average</h5>
                                            <div class="formula">
                                                \\[\\text{Metric}_{\\text{weighted}} = \\frac{\\sum_{i=1}^{C} \\text{Metric}_i \\times \\text{Support}_i}{\\sum_{i=1}^{C} \\text{Support}_i}\\]
                                            </div>
                                            <p class="formula-description">
                                                Weight by class frequency (reflects overall performance)
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <!-- Resource Metrics -->
                                    <div class="metric-group">
                                        <h4>⚡ Resource Metrics</h4>
                                        
                                        <div class="formula-card">
                                            <h5>FLOPs (Floating Point Operations)</h5>
                                            <div class="formula">
                                                \\[\\text{FLOPs} = \\sum_{l=1}^{L} \\text{FLOPs}_l = \\sum_{l=1}^{L} 2 \\times \\text{MACs}_l\\]
                                            </div>
                                            <p class="formula-description">
                                                Total floating point operations for one forward pass (FLOPs ≈ 2 × MACs)
                                            </p>
                                        </div>
                                        
                                        <div class="formula-card">
                                            <h5>Model Parameters</h5>
                                            <div class="formula">
                                                \\[\\text{Parameters} = \\sum_{l=1}^{L} \\text{params}_l = \\sum_{l=1}^{L} \\text{weights}_l + \\text{biases}_l\\]
                                            </div>
                                            <p class="formula-description">
                                                Total number of trainable parameters in the model
                                            </p>
                                        </div>
                                        
                                        <div class="formula-card">
                                            <h5>Transfer Learning</h5>
                                            <div class="formula">
                                                \\[\\text{Trainable Ratio} = \\frac{\\text{Trainable Parameters}}{\\text{Total Parameters}} = \\frac{\\text{Classifier Head}}{\\text{CNN Backbone + Classifier Head}}\\]
                                            </div>
                                            <p class="formula-description">
                                                In transfer learning, only classifier head is trainable (typically 0.1-1% of total parameters)
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <style>
                                .formulas-section {
                                    max-width: 1000px;
                                    margin: 0 auto;
                                    padding: 2rem;
                                }
                                
                                .metric-group {
                                    margin-bottom: 2rem;
                                    padding: 1.5rem;
                                    background: #f8f9fa;
                                    border-radius: 12px;
                                    border-left: 4px solid #007bff;
                                }
                                
                                .metric-group h4 {
                                    color: #007bff;
                                    margin-bottom: 1.5rem;
                                    font-size: 1.3rem;
                                }
                                
                                .formula-card {
                                    background: white;
                                    padding: 1.5rem;
                                    margin-bottom: 1.5rem;
                                    border-radius: 8px;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                    border-left: 3px solid #28a745;
                                }
                                
                                .formula-card h5 {
                                    color: #28a745;
                                    margin-bottom: 1rem;
                                    font-size: 1.1rem;
                                }
                                
                                .formula {
                                    text-align: center;
                                    margin: 1rem 0;
                                    padding: 1rem;
                                    background: #f8f9fa;
                                    border-radius: 6px;
                                    font-size: 1.1rem;
                                }
                                
                                .formula-description {
                                    color: #666;
                                    font-style: italic;
                                    margin-top: 0.5rem;
                                    line-height: 1.5;
                                }
                                </style>
                            `;
                        }
                        
                        // Wait for KaTeX to load
                        setTimeout(() => {
                            if (typeof renderMathInElement !== 'undefined') {
                                console.log('Rendering KaTeX for formulas tab...');
                                renderMathInElement(formulasContainer, {
                                    delimiters: [
                                        {left: '\\(', right: '\\)', display: false},
                                        {left: '\\[', right: '\\]', display: true}
                                    ],
                                    throwOnError: false
                                });
                                console.log('KaTeX rendering completed for formulas tab');
                            } else {
                                console.error('renderMathInElement not available, trying alternative...');
                                // Fallback: try direct KaTeX rendering
                                if (typeof katex !== 'undefined') {
                                    const mathElements = formulasContainer.querySelectorAll('.formula');
                                    mathElements.forEach(element => {
                                        try {
                                            katex.render(element.textContent, element, {
                                                throwOnError: false
                                            });
                                        } catch (e) {
                                            console.error('KaTeX rendering error:', e);
                                        }
                                    });
                                }
                            }
                        }, 200);
                    }
                }, 100);
            }
        };
        
        // Function to initialize comparison tables with real data
        function initializeComparisonTables(data) {
            // Populate Performance table
            const performanceTbody = document.getElementById('performance-table-body');
            if (performanceTbody) {
                performanceTbody.innerHTML = '';
                
                // Group models by architecture and augmentation
                const modelGroups = {};
                Object.entries(data.models).forEach(([modelName, model]) => {
                    const baseName = modelName.replace(' (Aug)', '').replace(' (No Aug)', '');
                    const isAug = modelName.includes('(Aug)');
                    
                    if (!modelGroups[baseName]) {
                        modelGroups[baseName] = { aug: null, noAug: null };
                    }
                    
                    if (isAug) {
                        modelGroups[baseName].aug = { name: modelName, data: model };
                    } else {
                        modelGroups[baseName].noAug = { name: modelName, data: model };
                    }
                });
                
                const metrics = ['precision', 'recall', 'f1_score', 'accuracy', 'top5_accuracy'];
                
                Object.entries(modelGroups).forEach(([baseName, group]) => {
                    // Create row for Augmented version
                    if (group.aug) {
                        const row = document.createElement('tr');
                        let rowHTML = `<td><strong>${baseName} (Aug)</strong></td>`;
                        
                        metrics.forEach(metric => {
                            const value = group.aug.data[metric];
                            const isBest = isBestInColumn(Object.entries(data.models), metric, value);
                            const className = isBest ? 'best' : '';
                            rowHTML += `<td><span class="metric-value ${className}">${(value * 100).toFixed(1)}</span></td>`;
                        });
                        
                        row.innerHTML = rowHTML;
                        performanceTbody.appendChild(row);
                    }
                    
                    // Create row for No Augmentation version
                    if (group.noAug) {
                        const row = document.createElement('tr');
                        let rowHTML = `<td><strong>${baseName} (No Aug)</strong></td>`;
                        
                        metrics.forEach(metric => {
                            const value = group.noAug.data[metric];
                            const isBest = isBestInColumn(Object.entries(data.models), metric, value);
                            const className = isBest ? 'best' : '';
                            rowHTML += `<td><span class="metric-value ${className}">${(value * 100).toFixed(1)}</span></td>`;
                        });
                        
                        row.innerHTML = rowHTML;
                        performanceTbody.appendChild(row);
                    }
                });
            }
            
            // Populate Resources table
            const resourcesTbody = document.getElementById('resources-table-body');
            if (resourcesTbody) {
                resourcesTbody.innerHTML = '';
                
                // Group models by architecture and augmentation
                const modelGroups = {};
                Object.entries(data.models).forEach(([modelName, model]) => {
                    const baseName = modelName.replace(' (Aug)', '').replace(' (No Aug)', '');
                    const isAug = modelName.includes('(Aug)');
                    
                    if (!modelGroups[baseName]) {
                        modelGroups[baseName] = { aug: null, noAug: null };
                    }
                    
                    if (isAug) {
                        modelGroups[baseName].aug = { name: modelName, data: model };
                    } else {
                        modelGroups[baseName].noAug = { name: modelName, data: model };
                    }
                });
                
                const resourceMetrics = ['training_time', 'inference_time', 'flops', 'parameters', 'model_size'];
                
                Object.entries(modelGroups).forEach(([baseName, group]) => {
                    // Create row for Augmented version
                    if (group.aug) {
                        const row = document.createElement('tr');
                        let rowHTML = `<td><strong>${baseName} (Aug)</strong></td>`;
                        
                        resourceMetrics.forEach(metric => {
                            const value = group.aug.data[metric];
                            const isBest = isBestInColumn(Object.entries(data.models), metric, value, 'resources');
                            const className = isBest ? 'best' : '';
                            let displayValue;
                            
                            if (metric === 'flops') {
                                displayValue = `${(value / 1e9).toFixed(1)}`;
                            } else if (metric === 'parameters') {
                                displayValue = `${value.toFixed(1)}`;
                            } else if (metric === 'model_size') {
                                displayValue = `${value.toFixed(1)}`;
                            } else if (metric === 'training_time') {
                                displayValue = `${value.toFixed(1)}`;
                            } else {
                                displayValue = `${value.toFixed(1)}`;
                            }
                            
                            rowHTML += `<td><span class="metric-value ${className}">${displayValue}</span></td>`;
                        });
                        
                        row.innerHTML = rowHTML;
                        if (row.querySelector('.best')) {
                            row.classList.add('best-row');
                        }
                        resourcesTbody.appendChild(row);
                    }
                    
                    // Create row for No Augmentation version
                    if (group.noAug) {
                        const row = document.createElement('tr');
                        let rowHTML = `<td><strong>${baseName} (No Aug)</strong></td>`;
                        
                        resourceMetrics.forEach(metric => {
                            const value = group.noAug.data[metric];
                            const isBest = isBestInColumn(Object.entries(data.models), metric, value, 'resources');
                            const className = isBest ? 'best' : '';
                            let displayValue;
                            
                            if (metric === 'flops') {
                                displayValue = `${(value / 1e9).toFixed(1)}`;
                            } else if (metric === 'parameters') {
                                displayValue = `${value.toFixed(1)}`;
                            } else if (metric === 'model_size') {
                                displayValue = `${value.toFixed(1)}`;
                            } else if (metric === 'training_time') {
                                displayValue = `${value.toFixed(1)}`;
                            } else {
                                displayValue = `${value.toFixed(1)}`;
                            }
                            
                            rowHTML += `<td><span class="metric-value ${className}">${displayValue}</span></td>`;
                        });
                        
                        row.innerHTML = rowHTML;
                        if (row.querySelector('.best')) {
                            row.classList.add('best-row');
                        }
                        resourcesTbody.appendChild(row);
                    }
                });
            }
            
            // Add click handlers to comparison table rows
            const comparisonRows = document.querySelectorAll('.comparison-table tbody tr');
            comparisonRows.forEach((row, index) => {
                row.style.cursor = 'pointer';
                row.addEventListener('click', function() {
                    // Remove previous selection
                    comparisonRows.forEach(r => r.style.backgroundColor = '');
                    
                    // Highlight selected row
                    this.style.backgroundColor = '#e3f2fd';
                    
                    // Get model name from first cell
                    const modelName = this.cells[0].textContent.trim();
                    
                    // Clear selection info
                    const infoDiv = document.getElementById('model-selection-info');
                    infoDiv.innerHTML = '';
                    
                    // Show confusion matrix for selected model
                    showConfusionMatrix(modelName, data);
                });
            });
        }
        
        // Helper function to check if value is best in column
        function isBestInColumn(models, metric, value, type = 'performance') {
            if (type === 'performance') {
                // Higher is better for performance metrics
                const maxValue = Math.max(...models.map(([name, model]) => model[metric]));
                return Math.abs(value - maxValue) < 0.0001; // Floating point tolerance
            } else if (type === 'resources') {
                // Lower is better for resource metrics
                const minValue = Math.min(...models.map(([name, model]) => model[metric]));
                return Math.abs(value - minValue) < 0.0001; // Floating point tolerance
            }
            return false;
        }
        
        // Function to show confusion matrix for selected model
        function showConfusionMatrix(modelName, data) {
            // Map model names to actual keys in data
            let modelKey = '';
            switch(modelName) {
                case 'VGG16 (No Aug)':
                    modelKey = 'VGG16 Noaug (Aug)';
                    break;
                case 'VGG16 (Aug)':
                    modelKey = 'VGG16 Aug (Aug)';
                    break;
                case 'ResNet50 (Aug)':
                    modelKey = 'ResNet50 Aug (Aug)';
                    break;
                case 'ResNet50 (No Aug)':
                    modelKey = 'ResNet50 Noaug (Aug)';
                    break;
                case 'Xception (Aug)':
                    modelKey = 'Xception Aug (Aug)';
                    break;
                case 'Xception (No Aug)':
                    modelKey = 'Xception Noaug (Aug)';
                    break;
                case 'EfficientNet-B3 (Aug)':
                    modelKey = 'EfficientNet B3 Aug (Aug)';
                    break;
                case 'EfficientNet-B3 (No Aug)':
                    modelKey = 'EfficientNet B3 Noaug (Aug)';
                    break;
                case 'MobileNetV3-Large-100 (Aug)':
                    modelKey = 'MobileNetV3 Large 100 Aug (Aug)';
                    break;
                case 'MobileNetV3-Large-100 (No Aug)':
                    modelKey = 'MobileNetV3 Large 100 Noaug (Aug)';
                    break;
                default:
                    modelKey = 'ResNet50 Aug (Aug)'; // Default fallback
            }
            
            const confusionMatrix = data.models[modelKey].confusion_matrix;
            if (!confusionMatrix) {
                console.error('No confusion data found for model:', modelKey);
                return;
            }
            
            const matrix = confusionMatrix;
            // Generate class names (37 classes for Oxford Pets)
            const classNames = Array.from({length: 37}, (_, i) => `Class ${i + 1}`);
            
            const plotData = [{
                z: matrix,
                x: classNames,
                y: classNames,
                type: 'heatmap',
                colorscale: 'Blues',
                showscale: true,
                hoverongaps: false,
                hovertemplate: 'True: %{y}<br>Predicted: %{x}<br>Count: %{z}<extra></extra>'
            }];
            
            const layout = {
                title: {
                    text: `Confusion Matrix - ${modelName}`,
                    font: { size: 16 }
                },
                xaxis: {
                    title: 'Predicted Class',
                    tickangle: -45,
                    tickfont: { size: 10 }
                },
                yaxis: {
                    title: 'True Class',
                    tickfont: { size: 10 }
                },
                width: 800,
                height: 600,
                margin: { l: 150, r: 50, t: 80, b: 150 }
            };
            
            const config = {
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
            };
            
            // Render the confusion matrix
            Plotly.newPlot('confusion-matrix-plotly', plotData, layout, config)
                .then(() => {
                    console.log('Plotly heatmap rendered successfully!');
                })
                .catch(error => {
                    console.error('Error rendering Plotly heatmap:', error);
                });
        }
    });
</script>

<style>
/* Enhanced Table Styles */
.enhanced-table {
    border-collapse: collapse;
    width: 100%;
    margin: 0;
    font-size: 14px;
}

.enhanced-table .table-header-row {
    background: linear-gradient(135deg, #8B5CF6, #7C3AED) !important;
    color: white !important;
    font-weight: 600;
    text-align: center;
    height: 50px;
}

.enhanced-table .table-header-row th {
    padding: 12px 8px;
    border: none;
    font-size: 13px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.enhanced-table .model-column {
    text-align: left !important;
    padding-left: 16px !important;
}

.enhanced-table .metric-column {
    text-align: center;
    font-weight: 600;
}

.enhanced-table tbody tr {
    height: 36px; /* 60% of original 60px */
    border-bottom: 1px solid #E5E7EB;
    transition: all 0.2s ease;
}

.enhanced-table tbody tr:hover {
    background-color: #F9FAFB;
}

.enhanced-table tbody tr td {
    padding: 8px 12px;
    text-align: center;
    vertical-align: middle;
    border: none;
}

.enhanced-table tbody tr td:first-child {
    text-align: left;
    padding-left: 16px;
    font-weight: 500;
    color: #374151;
}

.enhanced-table tbody tr td:not(:first-child) {
    color: #2563EB; /* Blue color for numbers */
    font-weight: 500;
    font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
}

/* Best value highlighting - only highlight the numbers, not the entire row */
.enhanced-table tbody tr.best-row {
    /* No background change for the row */
}

.enhanced-table tbody tr.best-row td {
    /* Keep normal row styling */
}

.enhanced-table tbody tr.best-row td:first-child {
    /* Keep normal model column styling */
}

/* Highlight only the best numbers */
.enhanced-table .metric-value.best {
    background-color: #10B981 !important;
    color: white !important;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 4px;
    display: inline-block;
}

/* Table note styling */
.table-note {
    margin-top: 12px;
    padding: 8px 12px;
    background-color: #F3F4F6;
    border-left: 4px solid #8B5CF6;
    border-radius: 4px;
    font-size: 12px;
    color: #6B7280;
}

.table-note strong {
    color: #374151;
    font-weight: 600;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .enhanced-table {
        font-size: 12px;
    }
    
    .enhanced-table .table-header-row th {
        padding: 8px 4px;
        font-size: 11px;
    }
    
    .enhanced-table tbody tr {
        height: 32px;
    }
    
    .enhanced-table tbody tr td {
        padding: 6px 8px;
    }
}

/* Remove arrow indicators from CSS since they're already in HTML */
</style>

</body>
</html>