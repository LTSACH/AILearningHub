<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BERT for Text Classification | BBC News</title>
    
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    
    <!-- Chart.js for loss curves -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Walkthrough CSS -->
    <link rel="stylesheet" href="assets/css/walkthrough.css">
    
    <!-- Main CSS -->
    <style>
        
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
    }
    
    /* Metric direction arrows */
    .metric-arrow {
        font-size: 0.8em;
        opacity: 0.6;
        margin-left: 0.25rem;
    }
    
    .metric-arrow-up {
        color: #ff8c00;
    }
    
    .metric-arrow-down {
        color: #ff8c00;
    }
    
    /* Navigation */
    .navbar {
        background: white;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .navbar .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .brand {
        font-size: 1.5rem;
        font-weight: bold;
        color: #667eea;
        text-decoration: none;
    }
    
    .nav-links {
        display: flex;
        gap: 2rem;
        list-style: none;
    }
    
    .nav-links a {
        text-decoration: none;
        color: #666;
        transition: color 0.3s;
    }
    
    .nav-links a:hover {
        color: #667eea;
    }
    
    /* Layout */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.5rem 2rem;
        margin-bottom: 2rem;
        border-radius: 12px;
    }
    
    .page-header h1 {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        color: #ffffff;
        font-weight: 700;
    }
    
    .page-header p {
        font-size: 1rem;
        color: #f0f0f0;
        font-weight: 500;
    }
    
    /* Pipeline Flow */
    .pipeline-flow {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        margin: 2rem 0;
        padding: 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        flex-wrap: wrap;
    }
    
    .step {
        flex: 1;
        min-width: 150px;
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
    }
    
    .step-fixed {
        background: #f3f4f6;
        border: 2px solid #d1d5db;
    }
    
    .step-interactive {
        background: #dbeafe;
        border: 2px dashed #3b82f6;
    }
    
    .step-result {
        background: #d1fae5;
        border: 2px solid #10b981;
    }
    
    .step-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .step-title {
        font-weight: bold;
        margin-bottom: 0.25rem;
    }
    
    .step-badge {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        margin-top: 0.5rem;
    }
    
    .step-detail {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
    }
    
    .arrow {
        font-size: 2rem;
        color: #667eea;
        font-weight: bold;
    }
    
    /* Feature Extractor Container (Nested Box) */
    .feature-extractor-container {
        flex: 2.5;
        background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%);
        border: 3px dashed #10b981;
        border-radius: 16px;
        padding: 1rem;
        min-width: 420px;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
    }
    
    .fe-header {
        text-align: center;
        margin-bottom: 0.75rem;
    }
    
    .fe-icon {
        font-size: 1.5rem;
    }
    
    .fe-title {
        font-size: 0.95rem;
        font-weight: bold;
        color: #059669;
        letter-spacing: 0.5px;
        margin: 0 0.5rem;
    }
    
    .fe-badge {
        display: inline-block;
        background: #10b981;
        color: white;
        padding: 0.25rem 0.6rem;
        border-radius: 10px;
        font-size: 0.7rem;
    }
    
    /* Internal mini-pipeline */
    .fe-internal-flow {
        display: flex;
        align-items: stretch;
        justify-content: center;
        gap: 0.5rem;
        background: white;
        padding: 0.75rem;
        border-radius: 10px;
        margin-bottom: 0.5rem;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    
    .fe-substep {
        flex: 1;
        padding: 0.75rem 0.5rem;
        border-radius: 8px;
        text-align: center;
        min-width: 100px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .fe-substep.fe-fixed {
        background: #f3f4f6;
        border: 2px solid #d1d5db;
    }
    
    .fe-substep.fe-interactive {
        background: #fef3c7;
        border: 2px dashed #f59e0b;
    }
    
    .substep-icon {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
    }
    
    .substep-name {
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 0.25rem;
        color: #333;
    }
    
    .substep-detail {
        font-size: 0.75rem;
        color: #666;
        line-height: 1.3;
    }
    
    .substep-note {
        font-size: 0.7rem;
        color: #999;
        margin-top: 0.25rem;
        font-style: italic;
    }
    
    .fe-arrow-small {
        display: flex;
        align-items: center;
        font-size: 1.2rem;
        color: #10b981;
        font-weight: bold;
    }
    
    .fe-output-info {
        text-align: center;
        font-size: 0.8rem;
        color: #059669;
        font-weight: 500;
        padding: 0.5rem;
        background: rgba(16, 185, 129, 0.1);
        border-radius: 6px;
    }
    
    .step-note {
        font-size: 0.75rem;
        color: #999;
        margin-top: 0.25rem;
    }
    
    /* Method Selector */
    .method-selector-container {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 2rem 0;
    }
    
    .selector-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .selector-header h3 {
        color: #333;
        font-size: 1.5rem;
    }
    
    .selector-actions {
        display: flex;
        gap: 1rem;
    }
    
    .btn-secondary {
        padding: 0.5rem 1rem;
        background: #f3f4f6;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-secondary:hover {
        background: #e5e7eb;
    }
    
    .method-checkboxes {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin: 0.75rem 0;
    }
    
    .method-checkbox-label {
        display: block;
        cursor: pointer;
    }
    
    .method-checkbox-label input[type="checkbox"] {
        display: none;
    }
    
    .method-card-mini {
        padding: 1.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        transition: all 0.3s;
    }
    
    .method-checkbox-label input:checked + .method-card-mini {
        border-color: #667eea;
        background: #f0f4ff;
    }
    
    .method-checkbox-label:hover .method-card-mini {
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .method-name {
        font-weight: bold;
        font-size: 1.1rem;
        color: #333;
        margin-bottom: 0.5rem;
    }
    
    .method-quick-stats {
        display: flex;
        gap: 1rem;
        margin: 0.5rem 0;
        font-size: 0.9rem;
        color: #666;
    }
    
    .method-description {
        color: #666;
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }
    
    .selector-footer {
        text-align: center;
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 2px solid #e5e7eb;
    }
    
    .btn-primary {
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .text-muted {
        color: #9ca3af;
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }
    
    /* Comparison Results */
    .comparison-results {
        margin-top: 0.5rem;
    }
    
    .comparison-content {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .comparison-table-container {
        overflow-x: auto;
        margin: 1rem 0;
    }
    
    .comparison-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .comparison-table th,
    .comparison-table td {
        padding: 0.75rem;
        text-align: center;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.9rem;
    }
    
    .comparison-table th {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-weight: 600;
        color: #ff8c00;
        position: sticky;
        top: 0;
        z-index: 10;
        font-size: 0.9rem;
    }
    
    .comparison-table th:first-child,
    .comparison-table td:first-child {
        text-align: left;
        position: sticky;
        left: 0;
        background: white;
        z-index: 5;
    }
    
    .comparison-table th:first-child {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        z-index: 15;
    }
    
    .comparison-table tbody tr:hover {
        background: #f0f4ff;
    }
    
    .comparison-table tbody tr:hover td:first-child {
        background: #f0f4ff;
    }
    
    .method-name-cell {
        font-weight: 600;
        color: #667eea;
        white-space: nowrap;
    }
    
    .metric-best {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: #78350f;
        font-weight: bold;
        box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
    }
    
    .metric-value {
        font-weight: 500;
    }
    
    .table-caption {
        text-align: center;
        color: #666;
        font-size: 0.9rem;
        margin-top: 1rem;
    }
    
    /* Confusion Matrices */
    .confusion-matrices-container {
        margin: 1.5rem 0 0 0;
    }
    
    .confusion-matrix-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 0.75rem 0;
    }
    
    .matrix-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.75rem 1rem;
    }
    
    .matrix-header h5 {
        margin: 0;
        font-size: 1.1rem;
    }
    
    .matrix-content {
        padding: 0.75rem;
    }
    
    /* Confusion matrix styling */
    .cm-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 6px;
        margin: 1rem 0;
    }
    
    .cm-table th,
    .cm-table td {
        padding: 12px;
        text-align: center;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .cm-table th {
        background: #667eea;
        color: white;
        font-size: 0.9rem;
    }
    
    .cm-table tbody th {
        background: #667eea;
        color: white;
        font-size: 0.9rem;
    }
    
    .cm-table td {
        background: #f3f4f6;
        color: #333;
        font-size: 1.1rem;
    }
    
    .cm-diagonal {
        background: linear-gradient(135deg, #10b981, #059669) !important;
        color: white !important;
        font-size: 1.2rem !important;
        box-shadow: 0 0 12px rgba(16, 185, 129, 0.4);
    }
    
    .cm-error-low {
        background: #fef3c7 !important;
        color: #92400e !important;
    }
    
    .cm-error-medium {
        background: #fed7aa !important;
        color: #9a3412 !important;
    }
    
    .cm-error-high {
        background: #fecaca !important;
        color: #991b1b !important;
        font-weight: 600 !important;
    }
    
    .cm-zero {
        background: #f9fafb !important;
        color: #d1d5db !important;
    }
    
    .per-class-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.75rem;
        margin: 0.75rem 0;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 8px;
    }
    
    .per-class-item {
        text-align: center;
        padding: 0.75rem;
        background: white;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
    }
    
    .per-class-label {
        font-weight: 600;
        color: #667eea;
        text-transform: capitalize;
        margin-bottom: 0.5rem;
    }
    
    .per-class-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #10b981;
    }
    
    /* Matrix view tabs */
    .matrix-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .matrix-tab-btn {
        padding: 0.75rem 1.5rem;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        color: #666;
        transition: all 0.3s;
    }
    
    .matrix-tab-btn:hover {
        color: #667eea;
        background: #f8f9fa;
    }
    
    .matrix-tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
        font-weight: 600;
    }
    
    .matrix-view {
        display: none;
    }
    
    .matrix-view.active {
        display: block;
    }
    
    /* Configuration tabs */
    .config-tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .config-tab-btn {
        padding: 0.75rem 1.5rem;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        color: #666;
        transition: all 0.3s;
    }
    
    .config-tab-btn:hover {
        color: #667eea;
        background: #f8f9fa;
    }
    
    .config-tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
        font-weight: 600;
    }
    
    .config-view {
        display: none;
    }
    
    .config-view.active {
        display: block;
    }
    
    /* Loss curves */
    .loss-curves-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }
    
    .loss-curves-container h4 {
        margin-bottom: 1.5rem;
        color: #1e293b;
        font-size: 1.3rem;
    }
    
    .charts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .chart-card {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
    }
    
    .chart-card h5 {
        margin-bottom: 1rem;
        color: #334155;
        font-size: 1.1rem;
        text-align: center;
    }
    
    .chart-container {
        position: relative;
        height: 300px;
        margin-bottom: 1rem;
    }
    
    .chart-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e5e7eb;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }
    
    .legend-color {
        width: 30px;
        height: 3px;
        border-radius: 2px;
    }
    
    /* Configuration display */
    .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .config-card {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        border: 2px solid #e5e7eb;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .config-card h4 {
        color: #667eea;
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .config-table {
        width: 100%;
    }
    
    .config-table tr {
        border-bottom: 1px solid #f3f4f6;
    }
    
    .config-table tr:last-child {
        border-bottom: none;
    }
    
    .config-table td {
        padding: 0.5rem 0;
        font-size: 0.9rem;
    }
    
    .config-table td:first-child {
        color: #666;
        font-weight: 500;
        width: 60%;
    }
    
    .config-table td:last-child {
        color: #333;
        font-weight: 600;
        text-align: right;
    }
    
    .tfidf-config {
        background: linear-gradient(135deg, #f0f4ff 0%, #e5edff 100%);
        border-color: #667eea;
    }
    
    /* Pipeline Tabs */
    .pipeline-section {
        margin-bottom: 2rem;
    }
    
    .pipeline-tabs {
        display: flex;
        gap: 0;
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 2rem;
    }
    
    .pipeline-tab-btn {
        background: none;
        border: none;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: 500;
        color: #6c757d;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
    }
    
    .pipeline-tab-btn.active {
        color: #667eea;
        border-bottom-color: #667eea;
    }
    
    .pipeline-tab-btn:hover {
        color: #667eea;
        background: #f8f9fa;
    }
    
    .pipeline-tab-content {
        display: none;
    }
    
    .pipeline-tab-content.active {
        display: block;
    }
    
    /* Tutorials Container */
    .tutorials-container {
        padding: 2rem 0;
    }
    
    .tutorial-section {
        margin-bottom: 3rem;
    }
    
    .tutorial-section h2 {
        font-size: 1.8rem;
        margin-bottom: 1.5rem;
        color: #2d3748;
    }
    
    .tutorial-card-compact {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        display: flex;
        gap: 1.5rem;
        align-items: start;
        margin-bottom: 1.5rem;
    }
    
    .tutorial-icon-compact {
        font-size: 2.5rem;
        flex-shrink: 0;
    }
    
    .tutorial-body-compact {
        flex: 1;
    }
    
    .tutorial-body-compact h3 {
        font-size: 1.3rem;
        margin-bottom: 0.75rem;
        color: #2d3748;
    }
    
    .tutorial-desc-compact {
        color: #666;
        line-height: 1.6;
        margin-bottom: 0.75rem;
    }
    
    .tutorial-formula {
        background: #f8f9fa;
        padding: 0.75rem;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        margin-bottom: 1rem;
        border-left: 3px solid #667eea;
    }
    
    .tutorial-links {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .tutorial-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
    }
    
    .tutorial-link:hover {
        color: #5a67d8;
        text-decoration: underline;
    }
    
    /* Code tab */
    .code-container {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .code-container h3 {
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
        color: #2d3748;
    }
    
    .code-description {
        color: #666;
        margin-bottom: 1.5rem;
        line-height: 1.6;
    }
    
    .code-actions-top {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        justify-content: flex-end;
    }
    
    .btn-copy-code-compact,
    .btn-download-code-compact {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
    }
    
    .btn-copy-code-compact {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .btn-copy-code-compact:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
    }
    
    .btn-download-code-compact {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        display: inline-block;
    }
    
    .btn-download-code-compact:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(245, 87, 108, 0.3);
    }
    
    .code-loading {
        color: #a0aec0;
        text-align: center;
        padding: 2rem;
        background: #2d3748;
        border-radius: 10px;
    }
    
    #code-block-container pre {
        background: #2d3748;
        border-radius: 10px;
        padding: 1.5rem;
        margin: 0;
        overflow-x: auto;
    }
    
    #code-block-container code {
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    
    /* Colab tab */
    .colab-container {
        padding: 3rem 2rem;
        max-width: 900px;
        margin: 0 auto;
        text-align: center;
    }
    
    .colab-header {
        margin-bottom: 2rem;
    }
    
    .colab-header h3 {
        font-size: 2rem;
        margin-top: 1rem;
        color: #2d3748;
    }
    
    .colab-description {
        color: #666;
        font-size: 1.1rem;
        margin-bottom: 2rem;
        line-height: 1.6;
    }
    
    .colab-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }
    
    .feature-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        justify-content: center;
        color: #666;
    }
    
    .feature-icon {
        font-size: 1.2rem;
        color: #28a745;
    }
    
    .colab-button {
        display: inline-flex;
        align-items: center;
        gap: 1rem;
        background: linear-gradient(135deg, #f9ab00 0%, #f57c00 100%);
        color: white;
        padding: 1.25rem 2.5rem;
        border-radius: 12px;
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(249, 171, 0, 0.3);
        margin-bottom: 2rem;
    }
    
    .colab-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(249, 171, 0, 0.4);
    }
    
    .colab-info {
        background: #f8f9fa;
        padding: 2rem;
        border-radius: 10px;
        text-align: left;
        border-left: 4px solid #667eea;
    }
    
    .colab-info h4 {
        margin-bottom: 1rem;
        color: #2d3748;
        font-size: 1.3rem;
    }
    
    .colab-info ul {
        list-style: none;
        padding: 0;
    }
    
    .colab-info li {
        padding: 0.5rem 0;
        color: #666;
        padding-left: 1.5rem;
        position: relative;
    }
    
    .colab-info li:before {
        content: "✓";
        position: absolute;
        left: 0;
        color: #28a745;
        font-weight: bold;
    }
    
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="../../index.html" class="brand">📰 BBC News Classification</a>
            <ul class="nav-links">
                <li><a href="../../index.html">Overview</a></li>
                <li><a href="../traditional_ml/index.html">Traditional ML</a></li>
                <li><a href="../pipeline_comparison/index.html">Pipeline Comparison</a></li>
                <li><a href="#" style="color: #667eea">BERT Fine-tuning</a></li>
                <li><a href="../../about.html">About</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>🤖 BERT for Text Classification</h1>
            <p>State-of-the-art transformer models with multiple pooling strategies</p>
        </div>

        <!-- Pipeline Visualization -->
        
        <div class="pipeline-section">
            <!-- Tabs -->
            <div class="pipeline-tabs">
                <button class="pipeline-tab-btn active" onclick="switchPipelineTab('pipeline')">
                    🔄 Pipeline
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('tutorials')">
                    📚 Tutorials
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('code')">
                    💻 Code
                </button>
                <button class="pipeline-tab-btn" onclick="switchPipelineTab('colab')">
                    🚀 Colab
                </button>
            </div>
            
            <!-- Tab 1: Pipeline (default) -->
            <div id="pipeline-tab" class="pipeline-tab-content active">
                <div class="pipeline-flow">
            <!-- Step 1: Text Input -->
            <div class="step step-fixed">
                <div class="step-icon">📝</div>
                <div class="step-title">Text Input</div>
                <div class="step-detail">"Business news..."</div>
            </div>
            
            <div class="arrow">→</div>
            
            <!-- Step 2: Feature Extractor (Nested) -->
            <div class="feature-extractor-container">
                <div class="fe-header">
                    <span class="fe-icon">🎯</span>
                    <span class="fe-title">FEATURE EXTRACTOR</span>
                    <span class="fe-badge">Choose Below</span>
                </div>
                
                <!-- Internal mini-pipeline -->
                <div class="fe-internal-flow">
                    <!-- Tokenizer -->
                    <div class="fe-substep fe-fixed">
                        <div class="substep-icon">🔤</div>
                        <div class="substep-name">Tokenizer</div>
                        <div class="substep-detail">WordPiece</div>
                    </div>
                    
                    <div class="fe-arrow-small">→</div>
                    
                    <!-- BERT Encoder (Interactive) -->
                    <div class="fe-substep fe-interactive">
                        <div class="substep-icon">🧠</div>
                        <div class="substep-name">BERT Encoder</div>
                        <div class="substep-detail">DistilBERT | BERT | TinyBERT</div>
                        <div class="substep-note">66M | 110M | 14M</div>
                    </div>
                    
                    <div class="fe-arrow-small">→</div>
                    
                    <!-- Pooling (Interactive) -->
                    <div class="fe-substep fe-interactive">
                        <div class="substep-icon">🎚️</div>
                        <div class="substep-name">Pooling</div>
                        <div class="substep-detail">[CLS] | Mean | Pooler</div>
                    </div>
                </div>
                
                <!-- Output dimension -->
                <div class="fe-output-info">
                    Output: 768-dimensional sentence vector
                </div>
            </div>
            
            <div class="arrow">→</div>
            
            <!-- Step 3: Task Head -->
            <div class="step step-fixed">
                <div class="step-icon">🤖</div>
                <div class="step-title">Task Head</div>
                <div class="step-badge">Classification</div>
                <div class="step-detail">Linear</div>
                <div class="step-note">768 → 5 classes</div>
            </div>
            
            <div class="arrow">→</div>
            
            <!-- Step 4: Results -->
            <div class="step step-result">
                <div class="step-icon">✨</div>
                <div class="step-title">Results</div>
                <div class="step-detail">90-98% accuracy</div>
            </div>
                </div>
            </div>
            
            <!-- Tab 2: Tutorials -->
            <div id="tutorials-tab" class="pipeline-tab-content">

                <div class="tutorials-container">
                    <!-- BERT Models Section -->
                    <div class="tutorial-section">
                        <h2>🤖 BERT Model Variants</h2>
                        
                        <div class="tutorial-card-compact">
                            <div class="tutorial-icon-compact">🧠</div>
                            <div class="tutorial-body-compact">
                                <h3>BERT-base (bert-base-uncased)</h3>
                                <p class="tutorial-desc-compact">
                                    <strong>Bidirectional Encoder Representations from Transformers</strong> - Base version with 12 transformer layers.
                                    Pre-trained on massive text corpora using masked language modeling (MLM) and next sentence prediction (NSP).
                                </p>
                                <p class="tutorial-formula">
                                    <strong>Architecture:</strong> 12 layers, 768 hidden size, 12 attention heads, 109.5M parameters
                                </p>
                                <div class="tutorial-links">
                                    <a href="https://huggingface.co/bert-base-uncased" target="_blank" class="tutorial-link">
                                        🤗 Hugging Face Model Card
                                    </a>
                                    <a href="https://arxiv.org/abs/1810.04805" target="_blank" class="tutorial-link">
                                        📄 Original BERT Paper
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tutorial-card-compact">
                            <div class="tutorial-icon-compact">⚡</div>
                            <div class="tutorial-body-compact">
                                <h3>DistilBERT (distilbert-base-uncased)</h3>
                                <p class="tutorial-desc-compact">
                                    Distilled version of BERT - <strong>40% smaller, 60% faster</strong>, retains 97% of BERT's performance.
                                    Uses knowledge distillation during pre-training to compress the model.
                                </p>
                                <p class="tutorial-formula">
                                    <strong>Architecture:</strong> 6 layers, 768 hidden size, 12 attention heads, 66.4M parameters
                                </p>
                                <div class="tutorial-links">
                                    <a href="https://huggingface.co/distilbert-base-uncased" target="_blank" class="tutorial-link">
                                        🤗 Hugging Face Model Card
                                    </a>
                                    <a href="https://arxiv.org/abs/1910.01108" target="_blank" class="tutorial-link">
                                        📄 DistilBERT Paper
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tutorial-card-compact">
                            <div class="tutorial-icon-compact">🚀</div>
                            <div class="tutorial-body-compact">
                                <h3>TinyBERT (huawei-noah/TinyBERT_General_4L_312D)</h3>
                                <p class="tutorial-desc-compact">
                                    Ultra-compact BERT - <strong>87% smaller, 7.5x faster inference</strong>.
                                    Uses two-stage knowledge distillation (general + task-specific) for extreme compression.
                                </p>
                                <p class="tutorial-formula">
                                    <strong>Architecture:</strong> 4 layers, 312 hidden size, 12 attention heads, 14.4M parameters
                                </p>
                                <div class="tutorial-links">
                                    <a href="https://huggingface.co/huawei-noah/TinyBERT_General_4L_312D" target="_blank" class="tutorial-link">
                                        🤗 Hugging Face Model Card
                                    </a>
                                    <a href="https://arxiv.org/abs/1909.10351" target="_blank" class="tutorial-link">
                                        📄 TinyBERT Paper
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pooling Strategies Section -->
                    <div class="tutorial-section">
                        <h2>🎯 Pooling Strategies</h2>
                        
                        <div class="tutorial-card-compact">
                            <div class="tutorial-icon-compact">📌</div>
                            <div class="tutorial-body-compact">
                                <h3>CLS Token Pooling</h3>
                                <p class="tutorial-desc-compact">
                                    Uses the final hidden state of the special [CLS] token (first token).
                                    BERT is pre-trained to encode sentence-level information in this token.
                                </p>
                                <p class="tutorial-formula">
                                    <strong>Formula:</strong> output = last_hidden_state[0, :]  (shape: [batch_size, hidden_size])
                                </p>
                                <div class="tutorial-links">
                                    <a href="https://huggingface.co/docs/transformers/main_classes/output#transformers.modeling_outputs.BaseModelOutputWithPoolingAndCrossAttentions" target="_blank" class="tutorial-link">
                                        📚 Transformers Output Documentation
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tutorial-card-compact">
                            <div class="tutorial-icon-compact">🔵</div>
                            <div class="tutorial-body-compact">
                                <h3>Pooler Output</h3>
                                <p class="tutorial-desc-compact">
                                    Takes [CLS] token hidden state and passes through additional dense layer + tanh activation.
                                    Provides a refined sentence representation optimized during pre-training.
                                </p>
                                <p class="tutorial-formula">
                                    <strong>Formula:</strong> output = tanh(dense(last_hidden_state[0, :]))
                                </p>
                                <div class="tutorial-links">
                                    <a href="https://huggingface.co/docs/transformers/main_classes/output#transformers.modeling_outputs.BaseModelOutputWithPoolingAndCrossAttentions.pooler_output" target="_blank" class="tutorial-link">
                                        📚 Pooler Output Documentation
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tutorial-card-compact">
                            <div class="tutorial-icon-compact">📊</div>
                            <div class="tutorial-body-compact">
                                <h3>Mean Pooling</h3>
                                <p class="tutorial-desc-compact">
                                    Averages hidden states across all tokens (excluding padding).
                                    Captures information from entire sequence, not just [CLS] token.
                                </p>
                                <p class="tutorial-formula">
                                    <strong>Formula:</strong> output = mean(last_hidden_state * attention_mask) / sum(attention_mask)
                                </p>
                                <div class="tutorial-links">
                                    <a href="https://www.sbert.net/examples/applications/computing-embeddings/README.html#sentence-embeddings-with-transformers" target="_blank" class="tutorial-link">
                                        📚 Mean Pooling Guide
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            
            <!-- Tab 3: Code -->
            <div id="code-tab" class="pipeline-tab-content">

                <div class="code-container">
                    <h3>📝 Python Implementation</h3>
                    <p class="code-description">
                        Complete code to fine-tune BERT models (BERT-base, DistilBERT, TinyBERT) with different pooling strategies
                        for BBC News classification.
                    </p>
                    
                    <div class="code-actions-top">
                        <button class="btn-copy-code-compact" onclick="copyCode()">📋 Copy</button>
                        <a href="code/bbc_bert_finetuning.py" download class="btn-download-code-compact">⬇️ Download</a>
                    </div>
                    
                    <div class="code-loading">⏳ Loading code...</div>
                    <div id="code-block-container">
                        <pre style="display: none;"><code id="python-code" class="language-python"></code></pre>
                    </div>
                </div>

            </div>
            
            <!-- Tab 4: Colab -->
            <div id="colab-tab" class="pipeline-tab-content">

                <div class="colab-container">
                    <div class="colab-header">
                        <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" style="height: 40px;">
                        <h3>🚀 Run in Google Colab</h3>
                    </div>
                    
                    <p class="colab-description">
                        Open this notebook in Google Colab to experiment with BERT fine-tuning for text classification.
                        Includes all 8 configurations (3 models × 3 pooling strategies).
                    </p>
                    
                    <div class="colab-features">
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            <span>Free GPU/TPU access</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            <span>Pre-installed libraries</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            <span>Interactive execution</span>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">✓</span>
                            <span>Modify & experiment</span>
                        </div>
                    </div>
                    
                    <a href="https://colab.research.google.com/github/LTSACH/AILearningHub/blob/main/04_Natural_Language_Processing/text_classification/notebooks/bbc_bert_finetuning.ipynb" 
                       target="_blank" 
                       class="colab-button">
                        <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab">
                        Open Notebook in Colab
                    </a>
                    
                    <div class="colab-info">
                        <h4>📚 What's included:</h4>
                        <ul>
                            <li>Dataset loading and preprocessing (BBC News)</li>
                            <li>Tokenization with BERT tokenizers</li>
                            <li>Model fine-tuning for 8 configurations</li>
                            <li>Training with PyTorch/Transformers</li>
                            <li>Evaluation metrics and confusion matrices</li>
                            <li>Pooling strategy comparisons</li>
                            <li>Model performance analysis</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>


        <!-- Method Selector -->
        <div id="method-selector"></div>
    </div>

    <!-- Embedded Data -->
    <script type="application/json" id="summary-data">
{
  "timestamp": "2025-10-20T15:00:00",
  "dataset": {
    "name": "BBC News",
    "train_samples": 1557,
    "val_samples": 334,
    "test_samples": 334,
    "num_classes": 5,
    "classes": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ]
  },
  "methods": [
    {
      "id": "bert_base_pooler_output",
      "name": "BERT-base + Pooler",
      "model_base": "bert_base",
      "pooling_strategy": "pooler_output",
      "accuracy": 98.80239520958084,
      "precision": 98.80899057413825,
      "recall": 98.80239520958084,
      "f1_score": 98.79938853736523,
      "train_time": "13.5s",
      "inference_time": "~0.22ms",
      "model_size": "417.72MB",
      "num_parameters": "109.5M",
      "description": "BERT-base + Pooler",
      "data_path": "../bert_base_pooler_output/results.json",
      "status": "available"
    },
    {
      "id": "bert_base_cls_token",
      "name": "BERT-base + CLS",
      "model_base": "bert_base",
      "pooling_strategy": "cls_token",
      "accuracy": 98.50299401197606,
      "precision": 98.50969442958525,
      "recall": 98.50299401197606,
      "f1_score": 98.50171615398807,
      "train_time": "13.0s",
      "inference_time": "~0.22ms",
      "model_size": "417.72MB",
      "num_parameters": "109.5M",
      "description": "BERT-base + CLS",
      "data_path": "../bert_base_cls_token/results.json",
      "status": "available"
    },
    {
      "id": "bert_base_mean_pooling",
      "name": "BERT-base + Mean",
      "model_base": "bert_base",
      "pooling_strategy": "mean_pooling",
      "accuracy": 98.50299401197606,
      "precision": 98.52447485980419,
      "recall": 98.50299401197606,
      "f1_score": 98.50280400874625,
      "train_time": "12.8s",
      "inference_time": "~0.26ms",
      "model_size": "417.72MB",
      "num_parameters": "109.5M",
      "description": "BERT-base + Mean",
      "data_path": "../bert_base_mean_pooling/results.json",
      "status": "available"
    },
    {
      "id": "distilbert_cls_token",
      "name": "DistilBERT + CLS",
      "model_base": "distilbert",
      "pooling_strategy": "cls_token",
      "accuracy": 98.20359281437125,
      "precision": 98.20970642115238,
      "recall": 98.20359281437125,
      "f1_score": 98.19451771367797,
      "train_time": "8.4s",
      "inference_time": "~0.12ms",
      "model_size": "253.20MB",
      "num_parameters": "66.4M",
      "description": "DistilBERT + CLS",
      "data_path": "../distilbert_cls_token/results.json",
      "status": "available"
    },
    {
      "id": "distilbert_mean_pooling",
      "name": "DistilBERT + Mean",
      "model_base": "distilbert",
      "pooling_strategy": "mean_pooling",
      "accuracy": 97.60479041916167,
      "precision": 97.63209745245672,
      "recall": 97.60479041916167,
      "f1_score": 97.60366150626125,
      "train_time": "8.0s",
      "inference_time": "~0.12ms",
      "model_size": "253.20MB",
      "num_parameters": "66.4M",
      "description": "DistilBERT + Mean",
      "data_path": "../distilbert_mean_pooling/results.json",
      "status": "available"
    },
    {
      "id": "tinybert_mean_pooling",
      "name": "TinyBERT + Mean",
      "model_base": "tinybert",
      "pooling_strategy": "mean_pooling",
      "accuracy": 91.31736526946108,
      "precision": 91.42421211768954,
      "recall": 91.31736526946108,
      "f1_score": 91.31098018027953,
      "train_time": "8.4s",
      "inference_time": "~0.10ms",
      "model_size": "54.77MB",
      "num_parameters": "14.4M",
      "description": "TinyBERT + Mean",
      "data_path": "../tinybert_mean_pooling/results.json",
      "status": "available"
    },
    {
      "id": "tinybert_pooler_output",
      "name": "TinyBERT + Pooler",
      "model_base": "tinybert",
      "pooling_strategy": "pooler_output",
      "accuracy": 90.41916167664671,
      "precision": 90.57646758606907,
      "recall": 90.41916167664671,
      "f1_score": 90.40158383975539,
      "train_time": "8.6s",
      "inference_time": "~0.08ms",
      "model_size": "54.77MB",
      "num_parameters": "14.4M",
      "description": "TinyBERT + Pooler",
      "data_path": "../tinybert_pooler_output/results.json",
      "status": "available"
    },
    {
      "id": "tinybert_cls_token",
      "name": "TinyBERT + CLS",
      "model_base": "tinybert",
      "pooling_strategy": "cls_token",
      "accuracy": 90.11976047904191,
      "precision": 90.20176737760032,
      "recall": 90.11976047904191,
      "f1_score": 90.11721670422381,
      "train_time": "8.0s",
      "inference_time": "~0.10ms",
      "model_size": "54.77MB",
      "num_parameters": "14.4M",
      "description": "TinyBERT + CLS",
      "data_path": "../tinybert_cls_token/results.json",
      "status": "available"
    }
  ]
}
    </script>
    
    <script type="application/json" id="methods-data">
{
  "bert_base_pooler_output": {
    "method": "bert_base_pooler_output",
    "display_name": "BERT-base + Pooler",
    "model_base": "bert_base",
    "pooling_strategy": "pooler_output",
    "timestamp": "2025-10-20T14:05:24.340838",
    "metrics": {
      "accuracy": 0.9880239520958084,
      "precision": 0.9880899057413824,
      "recall": 0.9880239520958084,
      "f1_score": 0.9879938853736523
    },
    "performance": {
      "inference_time_ms_per_sample": 0.22304721940786412,
      "total_test_samples": 334,
      "train_time_seconds": 13.524403095245361,
      "model_size_bytes": 438013135,
      "num_parameters": 109486085,
      "trainable_parameters": 109486085,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        74,
        1,
        2,
        0,
        0
      ],
      [
        0,
        58,
        0,
        0,
        0
      ],
      [
        1,
        0,
        61,
        0,
        0
      ],
      [
        0,
        0,
        0,
        77,
        0
      ],
      [
        0,
        0,
        0,
        0,
        60
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.9866666666666667,
        "recall": 0.961038961038961,
        "f1": 0.9736842105263158,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9830508474576272,
        "recall": 1.0,
        "f1": 0.9914529914529915,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.9682539682539683,
        "recall": 0.9838709677419355,
        "f1": 0.976,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 1.0,
        "recall": 1.0,
        "f1": 1.0,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 1.0,
        "recall": 1.0,
        "f1": 1.0,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "bert-base-uncased",
      "pooling_strategy": "Pooler Output",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "BERT built-in pooler: [CLS] \u2192 Dense(768\u2192768) \u2192 Tanh"
      }
    },
    "training_history": {
      "train_loss": [
        1.485213942527771,
        0.8145793080329895,
        0.3273489743471146,
        0.15051507145166398,
        0.10364022314548492
      ],
      "val_loss": [
        1.1389920711517334,
        0.47458887100219727,
        0.19869967798391977,
        0.1260144958893458,
        0.09241528809070587
      ],
      "val_accuracy": [
        0.7904191616766467,
        0.9640718562874252,
        0.9790419161676647,
        0.9790419161676647,
        0.9880239520958084
      ],
      "val_f1": [
        0.7823922683207188,
        0.9642625288326837,
        0.9789785975515292,
        0.978888092775834,
        0.9879908932135729
      ]
    }
  },
  "bert_base_cls_token": {
    "method": "bert_base_cls_token",
    "display_name": "BERT-base + CLS",
    "model_base": "bert_base",
    "pooling_strategy": "cls_token",
    "timestamp": "2025-10-20T14:05:23.930013",
    "metrics": {
      "accuracy": 0.9850299401197605,
      "precision": 0.9850969442958525,
      "recall": 0.9850299401197605,
      "f1_score": 0.9850171615398807
    },
    "performance": {
      "inference_time_ms_per_sample": 0.22470373182724684,
      "total_test_samples": 334,
      "train_time_seconds": 13.038097858428955,
      "model_size_bytes": 438013135,
      "num_parameters": 109486085,
      "trainable_parameters": 109486085,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        74,
        1,
        2,
        0,
        0
      ],
      [
        0,
        58,
        0,
        0,
        0
      ],
      [
        1,
        0,
        61,
        0,
        0
      ],
      [
        0,
        0,
        0,
        77,
        0
      ],
      [
        1,
        0,
        0,
        0,
        59
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.9736842105263158,
        "recall": 0.961038961038961,
        "f1": 0.9673202614379085,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9830508474576272,
        "recall": 1.0,
        "f1": 0.9914529914529915,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.9682539682539683,
        "recall": 0.9838709677419355,
        "f1": 0.976,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 1.0,
        "recall": 1.0,
        "f1": 1.0,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 1.0,
        "recall": 0.9833333333333333,
        "f1": 0.9915966386554622,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "bert-base-uncased",
      "pooling_strategy": "[CLS] Token",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "Use raw [CLS] token embedding from last hidden state"
      }
    },
    "training_history": {
      "train_loss": [
        1.135301558971405,
        0.18690081395208835,
        0.054209605157375336,
        0.028473811745643614,
        0.016803462505340577
      ],
      "val_loss": [
        0.3504641155401866,
        0.08602096140384674,
        0.07069046298662822,
        0.05222798387209574,
        0.05098316818475723
      ],
      "val_accuracy": [
        0.9610778443113772,
        0.9850299401197605,
        0.9850299401197605,
        0.9820359281437125,
        0.9850299401197605
      ],
      "val_f1": [
        0.9611441177616037,
        0.9850173674693206,
        0.9850173674693206,
        0.9820615061370234,
        0.9850173674693206
      ]
    }
  },
  "bert_base_mean_pooling": {
    "method": "bert_base_mean_pooling",
    "display_name": "BERT-base + Mean",
    "model_base": "bert_base",
    "pooling_strategy": "mean_pooling",
    "timestamp": "2025-10-20T14:05:51.473287",
    "metrics": {
      "accuracy": 0.9850299401197605,
      "precision": 0.9852447485980419,
      "recall": 0.9850299401197605,
      "f1_score": 0.9850280400874625
    },
    "performance": {
      "inference_time_ms_per_sample": 0.25798894592329985,
      "total_test_samples": 334,
      "train_time_seconds": 12.797273635864258,
      "model_size_bytes": 438013135,
      "num_parameters": 109486085,
      "trainable_parameters": 109486085,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        74,
        1,
        2,
        0,
        0
      ],
      [
        0,
        58,
        0,
        0,
        0
      ],
      [
        1,
        0,
        61,
        0,
        0
      ],
      [
        0,
        1,
        0,
        76,
        0
      ],
      [
        0,
        0,
        0,
        0,
        60
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.9866666666666667,
        "recall": 0.961038961038961,
        "f1": 0.9736842105263158,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9666666666666667,
        "recall": 1.0,
        "f1": 0.9830508474576272,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.9682539682539683,
        "recall": 0.9838709677419355,
        "f1": 0.976,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 1.0,
        "recall": 0.987012987012987,
        "f1": 0.9934640522875817,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 1.0,
        "recall": 1.0,
        "f1": 1.0,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "bert-base-uncased",
      "pooling_strategy": "Mean Pooling",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "Average all token embeddings (captures full context)"
      }
    },
    "training_history": {
      "train_loss": [
        1.2750728714466095,
        0.21036073803901673,
        0.07262112744152546,
        0.03683558225631714,
        0.02426055584102869
      ],
      "val_loss": [
        0.43590139349301654,
        0.08089468131462733,
        0.06366582959890366,
        0.06694913655519485,
        0.06408643970886867
      ],
      "val_accuracy": [
        0.9311377245508982,
        0.9730538922155688,
        0.9880239520958084,
        0.9850299401197605,
        0.9880239520958084
      ],
      "val_f1": [
        0.929420797023756,
        0.9730665028486504,
        0.9879908932135729,
        0.9849998918076366,
        0.9879908932135729
      ]
    }
  },
  "distilbert_cls_token": {
    "method": "distilbert_cls_token",
    "display_name": "DistilBERT + CLS",
    "model_base": "distilbert",
    "pooling_strategy": "cls_token",
    "timestamp": "2025-10-20T14:05:18.584713",
    "metrics": {
      "accuracy": 0.9820359281437125,
      "precision": 0.9820970642115238,
      "recall": 0.9820359281437125,
      "f1_score": 0.9819451771367796
    },
    "performance": {
      "inference_time_ms_per_sample": 0.11962938767213088,
      "total_test_samples": 334,
      "train_time_seconds": 8.393977165222168,
      "model_size_bytes": 265500315,
      "num_parameters": 66366725,
      "trainable_parameters": 66366725,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        73,
        1,
        2,
        1,
        0
      ],
      [
        0,
        57,
        0,
        0,
        1
      ],
      [
        1,
        0,
        61,
        0,
        0
      ],
      [
        0,
        0,
        0,
        77,
        0
      ],
      [
        0,
        0,
        0,
        0,
        60
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.9864864864864865,
        "recall": 0.948051948051948,
        "f1": 0.9668874172185431,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9827586206896551,
        "recall": 0.9827586206896551,
        "f1": 0.9827586206896551,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.9682539682539683,
        "recall": 0.9838709677419355,
        "f1": 0.976,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 0.9871794871794872,
        "recall": 1.0,
        "f1": 0.9935483870967742,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 0.9836065573770492,
        "recall": 1.0,
        "f1": 0.9917355371900827,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "distilbert-base-uncased",
      "pooling_strategy": "[CLS] Token",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "Use raw [CLS] token embedding from last hidden state"
      }
    },
    "training_history": {
      "train_loss": [
        1.3558762860298157,
        0.3637268766760826,
        0.09630831897258758,
        0.05328335717320442,
        0.042287238240242005
      ],
      "val_loss": [
        0.7416585087776184,
        0.1464535892009735,
        0.08756391704082489,
        0.06626866012811661,
        0.06569968909025192
      ],
      "val_accuracy": [
        0.9131736526946108,
        0.9700598802395209,
        0.9760479041916168,
        0.9790419161676647,
        0.9790419161676647
      ],
      "val_f1": [
        0.9124825690510259,
        0.9697091559910711,
        0.9759208173374506,
        0.9789853134620554,
        0.9788905051066341
      ]
    }
  },
  "distilbert_mean_pooling": {
    "method": "distilbert_mean_pooling",
    "display_name": "DistilBERT + Mean",
    "model_base": "distilbert",
    "pooling_strategy": "mean_pooling",
    "timestamp": "2025-10-20T14:05:37.331828",
    "metrics": {
      "accuracy": 0.9760479041916168,
      "precision": 0.9763209745245672,
      "recall": 0.9760479041916168,
      "f1_score": 0.9760366150626124
    },
    "performance": {
      "inference_time_ms_per_sample": 0.11969192160500419,
      "total_test_samples": 334,
      "train_time_seconds": 8.04724383354187,
      "model_size_bytes": 265500315,
      "num_parameters": 66366725,
      "trainable_parameters": 66366725,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        73,
        1,
        2,
        0,
        1
      ],
      [
        0,
        57,
        0,
        0,
        1
      ],
      [
        1,
        0,
        61,
        0,
        0
      ],
      [
        0,
        0,
        0,
        77,
        0
      ],
      [
        0,
        2,
        0,
        0,
        58
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.9864864864864865,
        "recall": 0.948051948051948,
        "f1": 0.9668874172185431,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.95,
        "recall": 0.9827586206896551,
        "f1": 0.9661016949152542,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.9682539682539683,
        "recall": 0.9838709677419355,
        "f1": 0.976,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 1.0,
        "recall": 1.0,
        "f1": 1.0,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 0.9666666666666667,
        "recall": 0.9666666666666667,
        "f1": 0.9666666666666667,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "distilbert-base-uncased",
      "pooling_strategy": "Mean Pooling",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "Average all token embeddings (captures full context)"
      }
    },
    "training_history": {
      "train_loss": [
        1.4698597049713136,
        0.45946812570095064,
        0.12482505351305008,
        0.06575192473828792,
        0.04617076136171818
      ],
      "val_loss": [
        0.9808152516682943,
        0.18179985384146372,
        0.09808145711819331,
        0.0863229309519132,
        0.07204672445853551
      ],
      "val_accuracy": [
        0.8892215568862275,
        0.9491017964071856,
        0.9760479041916168,
        0.9730538922155688,
        0.9730538922155688
      ],
      "val_f1": [
        0.8904387813754615,
        0.9482498880813058,
        0.9758970913698977,
        0.9729561119421616,
        0.9729561119421616
      ]
    }
  },
  "tinybert_mean_pooling": {
    "method": "tinybert_mean_pooling",
    "display_name": "TinyBERT + Mean",
    "model_base": "tinybert",
    "pooling_strategy": "mean_pooling",
    "timestamp": "2025-10-20T14:05:18.394356",
    "metrics": {
      "accuracy": 0.9131736526946108,
      "precision": 0.9142421211768953,
      "recall": 0.9131736526946108,
      "f1_score": 0.9131098018027953
    },
    "performance": {
      "inference_time_ms_per_sample": 0.09706310736827362,
      "total_test_samples": 334,
      "train_time_seconds": 8.40447449684143,
      "model_size_bytes": 57433770,
      "num_parameters": 14351813,
      "trainable_parameters": 14351813,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        68,
        1,
        2,
        3,
        3
      ],
      [
        1,
        51,
        3,
        1,
        2
      ],
      [
        4,
        0,
        57,
        1,
        0
      ],
      [
        0,
        0,
        2,
        75,
        0
      ],
      [
        0,
        3,
        3,
        0,
        54
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.9315068493150684,
        "recall": 0.8831168831168831,
        "f1": 0.9066666666666666,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9272727272727272,
        "recall": 0.8793103448275862,
        "f1": 0.9026548672566371,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.8507462686567164,
        "recall": 0.9193548387096774,
        "f1": 0.8837209302325582,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 0.9375,
        "recall": 0.974025974025974,
        "f1": 0.9554140127388535,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 0.9152542372881356,
        "recall": 0.9,
        "f1": 0.907563025210084,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "huawei-noah/TinyBERT_General_4L_312D",
      "pooling_strategy": "Mean Pooling",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "Average all token embeddings (captures full context)"
      }
    },
    "training_history": {
      "train_loss": [
        1.5145611715316774,
        1.012435462474823,
        0.6323449420928955,
        0.46613473653793336,
        0.4058466994762421
      ],
      "val_loss": [
        1.2710299889246623,
        0.7540897329648336,
        0.5204201738039652,
        0.4315153956413269,
        0.4086101253827413
      ],
      "val_accuracy": [
        0.5778443113772455,
        0.8143712574850299,
        0.8652694610778443,
        0.8922155688622755,
        0.8922155688622755
      ],
      "val_f1": [
        0.518122874693106,
        0.8161531861478056,
        0.8652992837675983,
        0.8928241444702423,
        0.8924561101063021
      ]
    }
  },
  "tinybert_pooler_output": {
    "method": "tinybert_pooler_output",
    "display_name": "TinyBERT + Pooler",
    "model_base": "tinybert",
    "pooling_strategy": "pooler_output",
    "timestamp": "2025-10-20T14:05:38.296604",
    "metrics": {
      "accuracy": 0.9041916167664671,
      "precision": 0.9057646758606908,
      "recall": 0.9041916167664671,
      "f1_score": 0.904015838397554
    },
    "performance": {
      "inference_time_ms_per_sample": 0.08144712027830957,
      "total_test_samples": 334,
      "train_time_seconds": 8.600958347320557,
      "model_size_bytes": 57433770,
      "num_parameters": 14351813,
      "trainable_parameters": 14351813,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        69,
        0,
        3,
        1,
        4
      ],
      [
        1,
        51,
        3,
        0,
        3
      ],
      [
        7,
        0,
        51,
        3,
        1
      ],
      [
        0,
        0,
        1,
        76,
        0
      ],
      [
        4,
        1,
        0,
        0,
        55
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.8518518518518519,
        "recall": 0.8961038961038961,
        "f1": 0.8734177215189873,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9807692307692307,
        "recall": 0.8793103448275862,
        "f1": 0.9272727272727272,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.8793103448275862,
        "recall": 0.8225806451612904,
        "f1": 0.85,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 0.95,
        "recall": 0.987012987012987,
        "f1": 0.9681528662420382,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 0.873015873015873,
        "recall": 0.9166666666666666,
        "f1": 0.8943089430894309,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "huawei-noah/TinyBERT_General_4L_312D",
      "pooling_strategy": "Pooler Output",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "BERT built-in pooler: [CLS] \u2192 Dense(768\u2192768) \u2192 Tanh"
      }
    },
    "training_history": {
      "train_loss": [
        1.591401309967041,
        1.4227077531814576,
        1.2274212217330933,
        1.1058234214782714,
        1.04718101978302
      ],
      "val_loss": [
        1.5295203526814778,
        1.3033836682637532,
        1.1440746386845906,
        1.0579551458358765,
        1.0283069610595703
      ],
      "val_accuracy": [
        0.5658682634730539,
        0.8263473053892215,
        0.8772455089820359,
        0.8892215568862275,
        0.9041916167664671
      ],
      "val_f1": [
        0.5217662419521858,
        0.8279239480762906,
        0.8769818202521098,
        0.8888991420562882,
        0.9046043656786593
      ]
    }
  },
  "tinybert_cls_token": {
    "method": "tinybert_cls_token",
    "display_name": "TinyBERT + CLS",
    "model_base": "tinybert",
    "pooling_strategy": "cls_token",
    "timestamp": "2025-10-20T14:05:47.469174",
    "metrics": {
      "accuracy": 0.9011976047904192,
      "precision": 0.9020176737760032,
      "recall": 0.9011976047904192,
      "f1_score": 0.9011721670422381
    },
    "performance": {
      "inference_time_ms_per_sample": 0.09516085314954449,
      "total_test_samples": 334,
      "train_time_seconds": 7.984382390975952,
      "model_size_bytes": 57433770,
      "num_parameters": 14351813,
      "trainable_parameters": 14351813,
      "batch_size": 64,
      "fp16_enabled": true
    },
    "confusion_matrix": [
      [
        67,
        1,
        3,
        2,
        4
      ],
      [
        1,
        53,
        3,
        0,
        1
      ],
      [
        5,
        0,
        56,
        0,
        1
      ],
      [
        0,
        0,
        2,
        75,
        0
      ],
      [
        3,
        4,
        3,
        0,
        50
      ]
    ],
    "per_class_metrics": [
      {
        "label": "business",
        "precision": 0.881578947368421,
        "recall": 0.8701298701298701,
        "f1": 0.8758169934640523,
        "support": 77
      },
      {
        "label": "entertainment",
        "precision": 0.9137931034482759,
        "recall": 0.9137931034482759,
        "f1": 0.9137931034482759,
        "support": 58
      },
      {
        "label": "politics",
        "precision": 0.835820895522388,
        "recall": 0.9032258064516129,
        "f1": 0.8682170542635659,
        "support": 62
      },
      {
        "label": "sport",
        "precision": 0.974025974025974,
        "recall": 0.974025974025974,
        "f1": 0.974025974025974,
        "support": 77
      },
      {
        "label": "tech",
        "precision": 0.8928571428571429,
        "recall": 0.8333333333333334,
        "f1": 0.8620689655172413,
        "support": 60
      }
    ],
    "labels": [
      "business",
      "entertainment",
      "politics",
      "sport",
      "tech"
    ],
    "model_config": {
      "architecture": "Transformer (BERT)",
      "pretrained_model": "huawei-noah/TinyBERT_General_4L_312D",
      "pooling_strategy": "[CLS] Token",
      "max_length": 128,
      "model_params": {
        "Learning Rate": 2e-05,
        "Batch Size": 64,
        "Epochs": 5,
        "Weight Decay": 0.01,
        "Warmup Ratio": 0.1,
        "Optimizer": "AdamW",
        "FP16": true,
        "Gradient Accumulation": 1,
        "Pooling": "Use raw [CLS] token embedding from last hidden state"
      }
    },
    "training_history": {
      "train_loss": [
        1.5792020082473754,
        1.1447721171379088,
        0.6962148141860962,
        0.5074122500419617,
        0.4346739852428436
      ],
      "val_loss": [
        1.4122322003046672,
        0.8368195295333862,
        0.5834462841351827,
        0.4750516613324483,
        0.44349170724550885
      ],
      "val_accuracy": [
        0.46407185628742514,
        0.8203592814371258,
        0.8502994011976048,
        0.874251497005988,
        0.8832335329341318
      ],
      "val_f1": [
        0.3357930901324843,
        0.8209108119518737,
        0.8517513225004822,
        0.8730214924635293,
        0.8824354169282376
      ]
    }
  }
}
    </script>

    <!-- Walkthrough JS -->
    <script src="assets/js/walkthrough.js"></script>

    <!-- Main JavaScript -->
    <script>
        
    // Load embedded data
    const summaryData = JSON.parse(document.getElementById('summary-data').textContent);
    const methodsData = JSON.parse(document.getElementById('methods-data').textContent);
    
    let selectedMethods = new Set();
    
    // Render method selector
    function renderMethodSelector() {
        const container = document.getElementById('method-selector');
        
        const methodsHTML = summaryData.methods.map(method => `
            <label class="method-checkbox-label">
                <input type="checkbox" 
                       class="method-checkbox" 
                       value="${method.id}"
                       onchange="toggleMethod('${method.id}')">
                <div class="method-card-mini">
                    <div class="method-name">${method.name}</div>
                    <div class="method-quick-stats">
                        <span>📊 ${method.accuracy.toFixed(1)}%</span>
                        <span>⚡ ${method.train_time}</span>
                    </div>
                    <div class="method-description">${method.description}</div>
                </div>
            </label>
        `).join('');
        
        container.innerHTML = `
            <div class="method-selector-container">
                <div class="selector-header">
                    <h3>Select Methods to Compare</h3>
                    <div class="selector-actions">
                        <button class="btn-secondary" onclick="selectAll()">Select All</button>
                        <button class="btn-secondary" onclick="clearAll()">Clear All</button>
                    </div>
                </div>
                
                <div class="method-checkboxes">
                    ${methodsHTML}
                </div>
                
                <div class="selector-footer">
                    <button class="btn-primary" onclick="compare()" id="compare-btn" disabled>
                        Compare Selected Methods
                    </button>
                    <p class="text-muted">Select at least one method to compare</p>
                </div>
                
                <div id="comparison-results" class="comparison-results"></div>
            </div>
        `;
    }
    
    function toggleMethod(methodId) {
        if (selectedMethods.has(methodId)) {
            selectedMethods.delete(methodId);
        } else {
            selectedMethods.add(methodId);
        }
        updateCompareButton();
    }
    
    function updateCompareButton() {
        const btn = document.getElementById('compare-btn');
        if (selectedMethods.size > 0) {
            btn.disabled = false;
            btn.textContent = `Compare ${selectedMethods.size} Method${selectedMethods.size > 1 ? 's' : ''}`;
        } else {
            btn.disabled = true;
            btn.textContent = 'Compare Selected Methods';
        }
    }
    
    function selectAll() {
        document.querySelectorAll('.method-checkbox').forEach(cb => {
            cb.checked = true;
            selectedMethods.add(cb.value);
        });
        updateCompareButton();
    }
    
    function clearAll() {
        document.querySelectorAll('.method-checkbox').forEach(cb => cb.checked = false);
        selectedMethods.clear();
        updateCompareButton();
    }
    
    function compare() {
        const methods = summaryData.methods.filter(m => selectedMethods.has(m.id));
        renderComparison(methods);
    }
    

    function renderComparison(methods) {
        const resultsContainer = document.getElementById('comparison-results');
        
        // Helper function to normalize inference time to microseconds
        const normalizeInferenceTime = (timeStr) => {
            const value = parseFloat(timeStr.replace(/[^0-9.]/g, ''));
            if (timeStr.includes('µs')) {
                return value;
            } else if (timeStr.includes('ms')) {
                return value * 1000;
            } else {
                return value;
            }
        };
        
        // Helper function to normalize model size to MB
        const normalizeModelSize = (sizeStr) => {
            const value = parseFloat(sizeStr.replace(/[^0-9.]/g, ''));
            return value;
        };
        
        // Find best/worst in each metric
        const metrics = {
            accuracy: { values: methods.map(m => m.accuracy), better: 'higher' },
            precision: { values: methods.map(m => m.precision), better: 'higher' },
            recall: { values: methods.map(m => m.recall), better: 'higher' },
            f1_score: { values: methods.map(m => m.f1_score), better: 'higher' },
            train_time: { values: methods.map(m => parseFloat(m.train_time.replace(/[^0-9.]/g, ''))), better: 'lower' },
            inference_time: { values: methods.map(m => normalizeInferenceTime(m.inference_time)), better: 'lower' },
            model_size: { values: methods.map(m => normalizeModelSize(m.model_size)), better: 'lower' }
        };
        
        // Find best values
        const best = {};
        Object.keys(metrics).forEach(key => {
            const values = metrics[key].values;
            if (metrics[key].better === 'higher') {
                best[key] = Math.max(...values);
            } else {
                best[key] = Math.min(...values);
            }
        });
        
        // GROUP by model, then sort by pooling
        const grouped = {};
        methods.forEach(method => {
            const methodData = methodsData[method.id];
            const modelBase = methodData ? methodData.model_base : method.model_base || 'N/A';
            if (!grouped[modelBase]) {
                grouped[modelBase] = [];
            }
            grouped[modelBase].push(method);
        });
        
        // Sort models: BERT > DistilBERT > TinyBERT
        const modelOrder = { 'bert_base': 1, 'distilbert': 2, 'tinybert': 3 };
        const sortedModels = Object.keys(grouped).sort((a, b) => modelOrder[a] - modelOrder[b]);
        
        // Sort pooling within each model: CLS > Mean > Pooler
        const poolingOrder = { 'cls_token': 1, 'mean_pooling': 2, 'pooler_output': 3 };
        sortedModels.forEach(modelKey => {
            grouped[modelKey].sort((a, b) => {
                const poolA = methodsData[a.id].pooling_strategy;
                const poolB = methodsData[b.id].pooling_strategy;
                return poolingOrder[poolA] - poolingOrder[poolB];
            });
        });
        
        // Build table rows with grouping
        const tableRows = [];
        sortedModels.forEach(modelKey => {
            grouped[modelKey].forEach((method, subIdx) => {
                const idx = methods.indexOf(method);
                const isBestAcc = method.accuracy === best.accuracy;
                const isBestPrec = method.precision === best.precision;
                const isBestRec = method.recall === best.recall;
                const isBestF1 = method.f1_score === best.f1_score;
                const isBestTrain = metrics.train_time.values[idx] === best.train_time;
                const isBestInf = metrics.inference_time.values[idx] === best.inference_time;
                const isBestSize = metrics.model_size.values[idx] === best.model_size;
                
                const methodData = methodsData[method.id];
                const pooling = methodData.pooling_strategy;
                
                // Format model name (show only on first row of group)
                const modelDisplayName = modelKey.replace('_', '-').toUpperCase();
                const modelCell = subIdx === 0 
                    ? `<td class="method-name-cell" rowspan="${grouped[modelKey].length}" style="vertical-align: middle; font-weight: 600; background: #f8f9fa;">${modelDisplayName}</td>`
                    : '';
                
                // Format pooling name
                const poolingDisplayName = pooling
                    .replace('cls_token', '[CLS]')
                    .replace('mean_pooling', 'Mean')
                    .replace('pooler_output', 'Pooler');
                
                tableRows.push(`
                    <tr>
                        ${modelCell}
                        <td class="metric-value">${poolingDisplayName}</td>
                        <td class="metric-value">${method.num_parameters || 'N/A'}</td>
                        <td class="metric-value ${isBestAcc ? 'metric-best' : ''}">${method.accuracy.toFixed(2)}%</td>
                        <td class="metric-value ${isBestPrec ? 'metric-best' : ''}">${method.precision.toFixed(2)}%</td>
                        <td class="metric-value ${isBestRec ? 'metric-best' : ''}">${method.recall.toFixed(2)}%</td>
                        <td class="metric-value ${isBestF1 ? 'metric-best' : ''}">${method.f1_score.toFixed(2)}%</td>
                        <td class="metric-value ${isBestTrain ? 'metric-best' : ''}">${method.train_time}</td>
                        <td class="metric-value ${isBestInf ? 'metric-best' : ''}">${method.inference_time}</td>
                        <td class="metric-value ${isBestSize ? 'metric-best' : ''}">${method.model_size}</td>
                    </tr>
                `);
            });
        });
        
        const tableRowsHTML = tableRows.join('');
        
        // Configuration HTML
        const configHTML = buildConfigurationTab(methods);
        
        // Confusion matrices
        const confusionMatrices = buildConfusionMatrices(methods);
        
        resultsContainer.innerHTML = `
            <div class="comparison-content">
                <h3>Comparison Results</h3>
                
                <!-- Tabs for Performance vs Configuration vs Loss Curves vs Formulas -->
                <div class="config-tabs">
                    <button class="config-tab-btn active" onclick="switchConfigView('performance')">
                        📊 Performance
                    </button>
                    <button class="config-tab-btn" onclick="switchConfigView('configuration')">
                        ⚙️ Configuration
                    </button>
                    <button class="config-tab-btn" onclick="switchConfigView('loss')">
                        📈 Loss Curves
                    </button>
                    <button class="config-tab-btn" onclick="switchConfigView('formulas')">
                        📐 Formulas
                    </button>
                </div>
                
                <!-- Performance View -->
                <div id="performance-view" class="config-view active">
                    <div class="comparison-table-container">
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>Model</th>
                                    <th>Pooling</th>
                                    <th>Params</th>
                                    <th>Accuracy <span class="metric-arrow metric-arrow-up">↑</span></th>
                                    <th>Precision <span class="metric-arrow metric-arrow-up">↑</span></th>
                                    <th>Recall <span class="metric-arrow metric-arrow-up">↑</span></th>
                                    <th>F1-Score <span class="metric-arrow metric-arrow-up">↑</span></th>
                                    <th>Train Time* <span class="metric-arrow metric-arrow-down">↓</span></th>
                                    <th>Inference** <span class="metric-arrow metric-arrow-down">↓</span></th>
                                    <th>Size <span class="metric-arrow metric-arrow-down">↓</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRowsHTML}
                            </tbody>
                        </table>
                        <p class="table-caption">
                            🏆 Highlighted = Best performer | ↑ Higher is better | ↓ Lower is better<br>
                            <span style="font-size: 0.85rem;">* Train Time: Total time to train entire model | ** Inference: Average time per sample</span>
                        </p>
                    </div>
                </div>
                
                <!-- Configuration View -->
                <div id="configuration-view" class="config-view">
                    ${configHTML}
                </div>
                
                <!-- Loss Curves View -->
                <div id="loss-view" class="config-view">
                    ${buildLossCurvesTab(methods)}
                </div>
                
                <!-- Formulas View -->
                <div id="formulas-view" class="config-view">
                    ${buildFormulasTab()}
                </div>
                
                <div class="confusion-matrices-container">
                    <h4>Confusion Matrices & Metrics</h4>
                    ${confusionMatrices}
                </div>
            </div>
        `;
        
        // Initialize all walkthroughs
        methods.forEach(method => {
            const data = methodsData[method.id];
            initWalkthrough(method.id, data.confusion_matrix, data.labels);
        });
        
        // Store loss curves data for rendering when tab is activated
        window.lossCurvesData = methods.map(m => {
            const data = methodsData[m.id];
            return {
                id: m.id,
                name: m.name,
                model_base: data.model_base,
                pooling: data.pooling_strategy,
                history: data.training_history
            };
        });
        
        resultsContainer.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Switch between performance, configuration, loss curves, and formulas views
    function switchConfigView(view) {
        const perfView = document.getElementById('performance-view');
        const confView = document.getElementById('configuration-view');
        const lossView = document.getElementById('loss-view');
        const formView = document.getElementById('formulas-view');
        const tabs = document.querySelectorAll('.config-tab-btn');
        
        // Hide all views
        perfView.classList.remove('active');
        confView.classList.remove('active');
        lossView.classList.remove('active');
        formView.classList.remove('active');
        tabs.forEach(t => t.classList.remove('active'));
        
        // Show selected view
        if (view === 'performance') {
            perfView.classList.add('active');
            tabs[0].classList.add('active');
        } else if (view === 'configuration') {
            confView.classList.add('active');
            tabs[1].classList.add('active');
        } else if (view === 'loss') {
            lossView.classList.add('active');
            tabs[2].classList.add('active');
            
            // Render loss curves when tab is activated (only once)
            if (!window.lossChartsRendered && window.lossCurvesData) {
                renderLossCurves(window.lossCurvesData);
                window.lossChartsRendered = true;
            }
        } else if (view === 'formulas') {
            formView.classList.add('active');
            tabs[3].classList.add('active');
            
            // Render KaTeX formulas when formulas tab is shown
            setTimeout(() => {
                if (typeof renderMathInElement !== 'undefined') {
                    renderMathInElement(formView, {
                        delimiters: [
                            {left: '\\(', right: '\\)', display: false},
                            {left: '\\[', right: '\\]', display: true}
                        ],
                        throwOnError: false
                    });
                }
            }, 50);
        }
    }
    

    function buildLossCurvesTab(methods) {
        // Create canvas elements for each chart
        return `
            <div class="loss-curves-container">
                <h4>📈 Training & Validation Loss Curves</h4>
                <p style="color: #64748b; margin-bottom: 1.5rem;">
                    Loss curves show model convergence during training. Lower loss = better fit.
                </p>
                
                <div class="charts-grid">
                    <!-- Loss Chart -->
                    <div class="chart-card">
                        <h5>Training & Validation Loss</h5>
                        <div class="chart-container">
                            <canvas id="loss-chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Accuracy Chart -->
                    <div class="chart-card">
                        <h5>Validation Accuracy</h5>
                        <div class="chart-container">
                            <canvas id="accuracy-chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- F1 Chart -->
                    <div class="chart-card">
                        <h5>Validation F1-Score</h5>
                        <div class="chart-container">
                            <canvas id="f1-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
                    <strong>💡 What to look for:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem; color: #92400e;">
                        <li><strong>Training Loss ↓:</strong> Model learning the training data</li>
                        <li><strong>Val Loss ↓:</strong> Model generalizing to unseen data</li>
                        <li><strong>Gap between Train/Val:</strong> Small gap = good generalization, large gap = overfitting</li>
                        <li><strong>Early plateau:</strong> Model converged; more epochs won't help</li>
                    </ul>
                </div>
            </div>
        `;
    }
    
    function buildFormulasTab() {
        return `
            <div style="max-width: 900px; margin: 0 auto;">
                <!-- Classification Metrics -->
                <div class="config-card" style="margin-bottom: 1.5rem;">
                    <h4>📊 Classification Metrics</h4>
                    <div style="line-height: 2.2;">
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                            <strong>Accuracy:</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{Accuracy} = \\frac{\\text{TP} + \\text{TN}}{\\text{TP} + \\text{TN} + \\text{FP} + \\text{FN}} = \\frac{\\sum_{i=1}^{n} \\text{CM}[i,i]}{\\text{Total Samples}} \\)
                            </span>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                            <strong>Precision (per class i):</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{Precision}_i = \\frac{\\text{TP}_i}{\\text{TP}_i + \\text{FP}_i} = \\frac{\\text{CM}[i,i]}{\\sum_{j=1}^{n} \\text{CM}[j,i]} \\)
                            </span>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                            <strong>Recall (per class i):</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{Recall}_i = \\frac{\\text{TP}_i}{\\text{TP}_i + \\text{FN}_i} = \\frac{\\text{CM}[i,i]}{\\sum_{j=1}^{n} \\text{CM}[i,j]} \\)
                            </span>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                            <strong>F1-Score (per class i):</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{F1}_i = \\frac{2 \\times \\text{Precision}_i \\times \\text{Recall}_i}{\\text{Precision}_i + \\text{Recall}_i} = \\frac{2 \\times \\text{CM}[i,i]}{\\text{Support}_i + \\text{Predicted}_i} \\)
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Averaging Methods -->
                <div class="config-card" style="margin-bottom: 1.5rem;">
                    <h4>📈 Averaging Methods</h4>
                    <div style="line-height: 2.2;">
                        <div style="padding: 0.75rem; background: #f0f4ff; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #667eea;">
                            <strong>Macro Average:</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{Metric}_{\\text{macro}} = \\frac{1}{n} \\sum_{i=1}^{n} \\text{Metric}_i \\)
                            </span><br>
                            <span style="font-size: 0.85rem; color: #666;">Equal weight to each class (good for imbalanced datasets)</span>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #f0fff4; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #10b981;">
                            <strong>Weighted Average:</strong><br>
                            <span style="font-size: 1.1rem; color: #10b981;">
                                \\( \\text{Metric}_{\\text{weighted}} = \\frac{\\sum_{i=1}^{n} \\text{Metric}_i \\times \\text{Support}_i}{\\sum_{i=1}^{n} \\text{Support}_i} \\)
                            </span><br>
                            <span style="font-size: 0.85rem; color: #666;">Weight by class frequency (reflects overall performance)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Confusion Matrix Components -->
                <div class="config-card">
                    <h4>🎯 Confusion Matrix Components</h4>
                    <div style="line-height: 2.2;">
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                            <strong>Support (per class i):</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{Support}_i = \\sum_{j=1}^{n} \\text{CM}[i,j] \\)
                            </span><br>
                            <span style="font-size: 0.85rem; color: #666;">Total actual instances of class i (row sum)</span>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.5rem;">
                            <strong>Predicted (per class i):</strong><br>
                            <span style="font-size: 1.1rem; color: #667eea;">
                                \\( \\text{Predicted}_i = \\sum_{j=1}^{n} \\text{CM}[j,i] \\)
                            </span><br>
                            <span style="font-size: 0.85rem; color: #666;">Total predicted instances of class i (column sum)</span>
                        </div>
                        
                        <div style="padding: 0.75rem; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #10b981;">
                            <strong>True Positives (per class i):</strong><br>
                            <span style="font-size: 1.1rem; color: #10b981;">
                                \\( \\text{TP}_i = \\text{CM}[i,i] \\)
                            </span><br>
                            <span style="font-size: 0.85rem; color: #666;">Diagonal element (correctly predicted instances)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Note -->
                <div style="background: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px; margin-top: 1.5rem; border-left: 4px solid #ffc107;">
                    <strong>💡 Note:</strong> All formulas use the confusion matrix (CM) as the primary data structure. 
                    For multi-class classification with <em>n</em> classes, CM is an <em>n × n</em> matrix where CM[i,j] represents 
                    the number of samples with true label <em>i</em> predicted as label <em>j</em>.
                </div>
            </div>
        `;
    }
    
    function buildConfigurationTab(methods) {
        // Tokenization configuration (common for all BERT models)
        const tokenConfigHTML = `
            <div class="config-card tfidf-config">
                <h4>🔤 Tokenization</h4>
                <table class="config-table">
                    <tr><td>Tokenizer</td><td>WordPiece (BERT)</td></tr>
                    <tr><td>Max Length</td><td>128 tokens</td></tr>
                    <tr><td>Padding</td><td>Max length</td></tr>
                    <tr><td>Truncation</td><td>Enabled</td></tr>
                    <tr><td>Vocabulary Size</td><td>~30,522</td></tr>
                    <tr><td>Special Tokens</td><td>[CLS], [SEP], [PAD]</td></tr>
                </table>
            </div>
        `;
        
        // Model configurations
        const modelConfigsHTML = methods.map(method => {
            const data = methodsData[method.id];
            const params = data.model_config.model_params || {};
            
            const paramsHTML = Object.entries(params).map(([key, value]) => {
                return `<tr><td>${key}</td><td>${value}</td></tr>`;
            }).join('');
            
            return `
                <div class="config-card">
                    <h4>🤖 ${method.name}</h4>
                    <table class="config-table">
                        ${paramsHTML}
                    </table>
                </div>
            `;
        }).join('');
        
        return `
            <div class="config-grid">
                ${tokenConfigHTML}
                ${modelConfigsHTML}
            </div>
        `;
    }
    
    // Render loss curves using Chart.js
    function renderLossCurves(data) {
        // Define colors for each model
        const colors = [
            { train: 'rgba(239, 68, 68, 0.8)', val: 'rgba(239, 68, 68, 0.4)', border: 'rgb(239, 68, 68)' },  // Red
            { train: 'rgba(59, 130, 246, 0.8)', val: 'rgba(59, 130, 246, 0.4)', border: 'rgb(59, 130, 246)' }, // Blue
            { train: 'rgba(16, 185, 129, 0.8)', val: 'rgba(16, 185, 129, 0.4)', border: 'rgb(16, 185, 129)' }, // Green
            { train: 'rgba(245, 158, 11, 0.8)', val: 'rgba(245, 158, 11, 0.4)', border: 'rgb(245, 158, 11)' }, // Orange
            { train: 'rgba(139, 92, 246, 0.8)', val: 'rgba(139, 92, 246, 0.4)', border: 'rgb(139, 92, 246)' }, // Purple
            { train: 'rgba(236, 72, 153, 0.8)', val: 'rgba(236, 72, 153, 0.4)', border: 'rgb(236, 72, 153)' }, // Pink
            { train: 'rgba(20, 184, 166, 0.8)', val: 'rgba(20, 184, 166, 0.4)', border: 'rgb(20, 184, 166)' }  // Teal
        ];
        
        // Prepare epochs array (assuming all models have same number of epochs)
        const numEpochs = data[0].history.train_loss.length;
        const epochs = Array.from({length: numEpochs}, (_, i) => i + 1);
        
        // --- Loss Chart ---
        const lossDatasets = [];
        data.forEach((model, idx) => {
            const color = colors[idx % colors.length];
            const modelName = model.model_base.toUpperCase().replace('_', '-');
            const poolingName = model.pooling.replace('_token', '').replace('_pooling', '').toUpperCase();
            const label = `${modelName} ${poolingName}`;
            
            // Training loss (solid line)
            lossDatasets.push({
                label: `${label} (Train)`,
                data: model.history.train_loss,
                borderColor: color.border,
                backgroundColor: color.train,
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointHoverRadius: 5
            });
            
            // Validation loss (dashed line)
            lossDatasets.push({
                label: `${label} (Val)`,
                data: model.history.val_loss,
                borderColor: color.border,
                backgroundColor: color.val,
                borderWidth: 2,
                borderDash: [5, 5],
                tension: 0.3,
                pointRadius: 3,
                pointHoverRadius: 5
            });
        });
        
        new Chart(document.getElementById('loss-chart'), {
            type: 'line',
            data: {
                labels: epochs,
                datasets: lossDatasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 10,
                            font: { size: 10 }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Epoch' },
                        grid: { display: true, color: 'rgba(0,0,0,0.05)' }
                    },
                    y: {
                        title: { display: true, text: 'Loss' },
                        grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                        beginAtZero: true
                    }
                }
            }
        });
        
        // --- Accuracy Chart ---
        const accDatasets = data.map((model, idx) => {
            const color = colors[idx % colors.length];
            const modelName = model.model_base.toUpperCase().replace('_', '-');
            const poolingName = model.pooling.replace('_token', '').replace('_pooling', '').toUpperCase();
            return {
                label: `${modelName} ${poolingName}`,
                data: model.history.val_accuracy.map(v => v * 100),  // Convert to percentage
                borderColor: color.border,
                backgroundColor: color.train,
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointHoverRadius: 5
            };
        });
        
        new Chart(document.getElementById('accuracy-chart'), {
            type: 'line',
            data: {
                labels: epochs,
                datasets: accDatasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 10,
                            font: { size: 10 }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: (context) => {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Epoch' },
                        grid: { display: true, color: 'rgba(0,0,0,0.05)' }
                    },
                    y: {
                        title: { display: true, text: 'Accuracy (%)' },
                        grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                        min: 70,
                        max: 100
                    }
                }
            }
        });
        
        // --- F1 Chart ---
        const f1Datasets = data.map((model, idx) => {
            const color = colors[idx % colors.length];
            const modelName = model.model_base.toUpperCase().replace('_', '-');
            const poolingName = model.pooling.replace('_token', '').replace('_pooling', '').toUpperCase();
            return {
                label: `${modelName} ${poolingName}`,
                data: model.history.val_f1.map(v => v * 100),  // Convert to percentage
                borderColor: color.border,
                backgroundColor: color.train,
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointHoverRadius: 5
            };
        });
        
        new Chart(document.getElementById('f1-chart'), {
            type: 'line',
            data: {
                labels: epochs,
                datasets: f1Datasets
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 10,
                            font: { size: 10 }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: (context) => {
                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Epoch' },
                        grid: { display: true, color: 'rgba(0,0,0,0.05)' }
                    },
                    y: {
                        title: { display: true, text: 'F1-Score (%)' },
                        grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                        min: 70,
                        max: 100
                    }
                }
            }
        });
    }
    

    function buildConfusionMatrices(methods) {
        return methods.map(method => {
            const data = methodsData[method.id];
            const cm = data.confusion_matrix;
            const labels = data.labels;
            const perClassMetrics = data.per_class_metrics;
            
            // Find max error for coloring
            const maxError = Math.max(...cm.flatMap((row, i) => row.filter((_, j) => i !== j)));
            
            const cmHTML = `
                <table class="cm-table">
                    <thead>
                        <tr>
                            <th>Actual \\\\ Pred</th>
                            ${labels.map(l => `<th>${l}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        ${cm.map((row, i) => `
                            <tr>
                                <th>${labels[i]}</th>
                                ${row.map((val, j) => {
                                    if (i === j) {
                                        return `<td class="cm-diagonal">${val}</td>`;
                                    } else if (val === 0) {
                                        return `<td class="cm-zero">0</td>`;
                                    } else {
                                        const severity = val / maxError;
                                        const className = severity > 0.5 ? 'cm-error-high' 
                                                        : severity > 0.2 ? 'cm-error-medium' 
                                                        : 'cm-error-low';
                                        return `<td class="${className}">${val}</td>`;
                                    }
                                }).join('')}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            const perClassHTML = `
                <div class="per-class-summary">
                    ${perClassMetrics.map(cls => `
                        <div class="per-class-item">
                            <div class="per-class-label">${cls.label}</div>
                            <div class="per-class-value">${(cls.f1 * 100).toFixed(1)}%</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Walkthrough HTML with embedded data
            const walkthroughHTML = `
                <div class="walkthrough-container" id="walkthrough-${method.id}">
                    <button class="walkthrough-fullscreen-btn" onclick="toggleFullscreen('${method.id}')">⛶ Fullscreen</button>
                    <div class="walkthrough-content">
                        <div class="walkthrough-grid">
                            <div class="walkthrough-left">
                                <div class="matrix-display">
                                    <h4 style="margin-bottom: 1rem; color: #333;">Confusion Matrix</h4>
                                    <table class="wt-cm-table" id="wt-matrix-${method.id}"></table>
                                </div>
                                
                                <div class="walkthrough-controls">
                                    <button class="wt-btn wt-btn-nav" onclick="wtPrevStep('${method.id}')">◀ Previous</button>
                                    <button class="wt-btn wt-btn-nav" onclick="wtNextStep('${method.id}')">Next ▶</button>
                                    <button class="wt-btn wt-btn-reset" onclick="wtReset('${method.id}')">↻ Reset</button>
                                </div>
                                
                                <div class="wt-progress-bar">
                                    <div class="wt-progress-fill" id="wt-progress-${method.id}"></div>
                                </div>
                                <div class="wt-progress-text" id="wt-progress-text-${method.id}">Step 1/12</div>
                            </div>
                            
                            <div class="walkthrough-right">
                                <div class="wt-step-info" id="wt-step-info-${method.id}">
                                    <h3>
                                        <span class="wt-step-number" id="wt-step-num-${method.id}">1</span>
                                        <span id="wt-step-title-${method.id}">Loading...</span>
                                    </h3>
                                    <p id="wt-step-desc-${method.id}"></p>
                                </div>
                                
                                <div class="wt-calculations" id="wt-calc-${method.id}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return `
                <div class="confusion-matrix-card">
                    <div class="matrix-header">
                        <h5>${method.name} - Accuracy: ${method.accuracy.toFixed(2)}%</h5>
                    </div>
                    <div class="matrix-content">
                        <h4>Per-Class F1-Score</h4>
                        ${perClassHTML}
                        
                        <h4 style="margin-top: 2rem;">Confusion Matrix</h4>
                        
                        <div class="matrix-tabs">
                            <button class="matrix-tab-btn active" onclick="switchMatrixView('${method.id}', 'matrix')">
                                📊 Confusion Matrix
                            </button>
                            <button class="matrix-tab-btn" onclick="switchMatrixView('${method.id}', 'walkthrough')">
                                🎓 Metrics Walkthrough
                            </button>
                        </div>
                        
                        <div id="matrix-view-${method.id}" class="matrix-view active">
                            ${cmHTML}
                            <p style="margin-top: 1rem; color: #666; font-size: 0.9rem; text-align: center;">
                                🟢 Diagonal = Correct Predictions | 🟡🟠🔴 = Errors (color intensity = severity)
                            </p>
                        </div>
                        
                        <div id="walkthrough-view-${method.id}" class="matrix-view">
                            ${walkthroughHTML}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }
    
    // Matrix view switching
    function switchMatrixView(methodId, view) {
        const matrixView = document.getElementById(`matrix-view-${methodId}`);
        const walkthroughView = document.getElementById(`walkthrough-view-${methodId}`);
        
        if (!matrixView || !walkthroughView) return;
        
        const matrixContent = matrixView.closest('.matrix-content');
        if (!matrixContent) return;
        
        const tabButtons = matrixContent.querySelectorAll('.matrix-tab-btn');
        tabButtons.forEach((btn, idx) => {
            if ((view === 'matrix' && idx === 0) || (view === 'walkthrough' && idx === 1)) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
        
        if (view === 'matrix') {
            matrixView.classList.add('active');
            walkthroughView.classList.remove('active');
        } else {
            matrixView.classList.remove('active');
            walkthroughView.classList.add('active');
        }
    }
    
    // Fullscreen functionality for walkthrough
    function toggleFullscreen(methodId) {
        const container = document.getElementById(`walkthrough-${methodId}`);
        const btn = document.querySelector(`#walkthrough-${methodId} .walkthrough-fullscreen-btn`);
        
        if (!container || !btn) {
            console.error('Fullscreen elements not found for method:', methodId);
            return;
        }
        
        if (container.classList.contains('fullscreen')) {
            container.classList.remove('fullscreen');
            btn.textContent = '⛶ Fullscreen';
            document.body.style.overflow = '';
        } else {
            container.classList.add('fullscreen');
            btn.textContent = '✕ Exit';
            document.body.style.overflow = 'hidden';
        }
    }
    

    // Tab switching function
    function switchPipelineTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.pipeline-tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Remove active from all buttons
        document.querySelectorAll('.pipeline-tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(tabName + '-tab').classList.add('active');
        
        // Activate button
        event.target.classList.add('active');
    }
    
    // Code loading and display
    let codeLoaded = false;
    let pythonCode = '';
    
    // Auto-load code when Code tab is opened
    document.addEventListener('DOMContentLoaded', function() {
        // Observer for Code tab visibility
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const codeTab = document.getElementById('code-tab');
                    if (codeTab && codeTab.classList.contains('active') && !codeLoaded) {
                        loadCode();
                    }
                }
            });
        });
        
        const codeTab = document.getElementById('code-tab');
        if (codeTab) {
            observer.observe(codeTab, { attributes: true });
        }
    });
    
    async function loadCode() {
        const loading = document.querySelector('.code-loading');
        const pre = document.querySelector('#code-block-container pre');
        const codeElement = document.getElementById('python-code');
        
        try {
            const response = await fetch('code/bbc_bert_finetuning.py');
            if (!response.ok) throw new Error('Failed to load code');
            pythonCode = await response.text();
            codeElement.textContent = pythonCode;
            
            // Highlight with Prism
            if (typeof Prism !== 'undefined') {
                Prism.highlightElement(codeElement);
            }
            
            loading.style.display = 'none';
            pre.style.display = 'block';
            codeLoaded = true;
        } catch (error) {
            loading.textContent = '❌ Failed to load code. File may not exist yet.';
            console.error(error);
        }
    }
    
    function copyCode() {
        if (!pythonCode) {
            alert('Please show the code first!');
            return;
        }
        
        navigator.clipboard.writeText(pythonCode).then(() => {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '✓ Copied!';
            btn.style.background = '#28a745';
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '';
            }, 2000);
        }).catch(err => {
            console.error('Copy failed:', err);
            alert('Failed to copy code');
        });
    }
    
    // Initialize on load
    renderMethodSelector();
    
    // ESC key to exit fullscreen
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const fullscreenContainer = document.querySelector('.walkthrough-container.fullscreen');
            if (fullscreenContainer) {
                const methodId = fullscreenContainer.id.replace('walkthrough-', '');
                toggleFullscreen(methodId);
            }
        }
    });
    
    </script>
</body>
</html>
